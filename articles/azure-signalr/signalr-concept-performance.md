---
title: Azure SignalR 服務的效能指南
description: Azure SignalR 服務的效能概觀。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: f7cc05c8c2a299d809c4386d119fef58fa2548d5
ms.sourcegitcommit: 48a41b4b0bb89a8579fc35aa805cea22e2b9922c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/15/2019
ms.locfileid: "59579235"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR 服務的效能指南

使用 Azure SignalR 服務的主要優點是能夠輕鬆調整 SignalR 應用程式。 在大規模的案例中，效能是重要的因素。 

本指南中，我們會介紹影響 SignalR 應用程式效能的因素。 我們將說明不同使用案例中的一般效能。 最後，我們會介紹的環境和工具，您可以用來產生效能報表。

## <a name="term-definitions"></a>詞彙定義

*輸入*:Azure SignalR 服務內送訊息。

*輸出*:來自 Azure SignalR 服務的外寄訊息。

*頻寬*:在 1 秒內的所有訊息的大小總計。

*預設模式*:預設的工作模式時建立 Azure SignalR 服務執行個體。 Azure SignalR 服務預期應用程式伺服器建立與它連線之前它會接受任何用戶端連線。

*無伺服器模式*:Azure SignalR 服務可接受只有用戶端連線的一種模式。 允許沒有伺服器連接。

## <a name="overview"></a>概觀

Azure SignalR 服務定義不同的效能容量的七個標準層。 本指南會回答下列問題：

-   什麼是標準的 Azure SignalR 服務效能，每個層級？

-   Azure SignalR 服務是否符合我的訊息輸送量 （例如，傳送 100,000 訊息每秒） 的需求？

-   我特定案例中，哪一層適合我？ 或者，我要如何選取適當的層？

-   何種應用程式伺服器 （VM 大小） 適合我？ 多少個應該部署？

為了回答上述問題，本指南第一次提供一個因素會影響效能的高層級說明。 它接著說明典型的使用案例中的每個層的最大輸入和輸出訊息： **echo**，**廣播**，**傳送至群組**，和**傳送至連接**（-對等聊天）。

本指南無法涵蓋所有案例 （和不同的使用情況下，訊息大小、 訊息傳送的模式，依此類推）。 不過，它會提供一些方法，以協助您：

- 評估您的輸入或輸出訊息的近似需求。
- 檢查效能資料表，以尋找適當的層級。

## <a name="performance-insight"></a>效能深入解析

本章節描述效能評估方法，並接著列出所有會影響效能的因素。 最後，它會提供方法來協助您評估效能需求。

### <a name="methodology"></a>方法

*輸送量*並*延遲*是兩個一般的效能檢查層面。 Azure SignalR 服務，每個 SKU 層都有它自己的輸送量節流原則。 原則會定義*允許的最大的輸送量 （輸入和輸出頻寬）* 為最大值達成的輸送量，99%的訊息較為少於 1 秒的延遲。

延遲是從連接傳送訊息至接收 Azure SignalR 服務的回應訊息的時間範圍。 讓我們來看**echo**做為範例。 每個用戶端連接會將時間戳記加入訊息中。 應用程式伺服器的中樞會將原始訊息傳送回用戶端。 因此傳播延遲輕鬆計算方式為每個用戶端連接。 針對每個訊息中附加的時間戳記**廣播**，**傳送給群組**，和**傳送給連接**。

若要模擬數千個並行用戶端連線，多個 Vm 會建立在 Azure 中的虛擬私人網路中。 這些 vm 連接到相同的 Azure SignalR 服務執行個體。

Azure SignalR 服務的預設模式，在應用程式伺服器 Vm 會部署在相同的虛擬私人網路為用戶端 Vm。 所有的用戶端 Vm 和應用程式伺服器 Vm 會部署在相同網路的相同地區內即可避免跨區域的延遲。

### <a name="performance-factors"></a>效能因素

理論上來說，Azure SignalR 服務容量受限於計算資源：CPU、 記憶體和網路。 例如，Azure SignalR 服務的更多連線會導致服務使用更多的記憶體。 較大的訊息流量 （例如，每則訊息是超過 2,048 個位元組），Azure SignalR 服務需要更多的 CPU 週期，來處理流量。 同時，Azure 的網路頻寬也會限制大小的最大的流量。

傳輸類型會影響效能的另一個因素。 三種類型[WebSocket](https://en.wikipedia.org/wiki/WebSocket)，[伺服器傳送事件](https://en.wikipedia.org/wiki/Server-sent_events)，並[長時間輪詢](https://en.wikipedia.org/wiki/Push_technology)。 

WebSocket 是雙向且為全雙工通訊協定，透過單一的 TCP 連線。 伺服器傳送事件推播訊息是單向的通訊協定，從伺服器到用戶端。 長時間輪詢要求用戶端會定期輪詢伺服器透過 HTTP 要求的資訊。 同樣的狀況下相同的 API，WebSocket 具有最佳的效能、 伺服器傳送事件較慢，以及長時間輪詢是最慢的作業。 Azure SignalR 服務預設建議 WebSocket。

訊息路由成本也會限制效能。 Azure SignalR 服務扮演的角色，為訊息路由器，會將訊息從一組用戶端或伺服器的其他用戶端或伺服器。 不同的案例或 API 需要不同的路由原則。 

針對**echo**、 用戶端將訊息傳送給自己，和路由目的地本身也是。 此模式沒有最低路由的成本。 但對於**廣播**，**傳送給群組**，和**傳送給連接**，Azure SignalR 服務需要查閱目標連接透過內部的分散式資料結構。 更多的 CPU、 記憶體和網路頻寬，則會使用這項額外處理。 如此一來，效能會變慢。

在預設模式中，應用程式伺服器可能也會成為瓶頸，以適用於特定案例。 Azure SignalR SDK 有叫用中樞，而它會維護與每個用戶端活動訊號的訊號的即時連線。

在無伺服器模式中，用戶端會透過 HTTP post，不是效率不如 WebSocket 傳送訊息。

另一個因素是通訊協定：JSON 並[MessagePack](https://msgpack.org/index.html)。 MessagePack 會較小的大小並將它傳遞比 JSON 更快。 MessagePack 可能不會改善效能，不過。 Azure SignalR 服務的效能不容易使用的通訊協定，因為它不會解碼訊息承載期間從用戶端或伺服器的訊息轉送。

總而言之，下列因素會影響輸入和輸出的容量：

-   SKU 層 （CPU/記憶體）

-   連線數目

-   訊息大小

-   訊息傳送速率

-   傳輸類型 (WebSocket，伺服器傳送的事件或長時間輪詢)

-   使用案例 （路由成本）

-   （在伺服器模式） 的應用程式伺服器和服務連線


### <a name="finding-a-proper-sku"></a>尋找適當的 SKU

您如何評估輸入/輸出的容量或尋找哪一層是適用於特定使用案例？

假設應用程式伺服器功能足以，而不是效能瓶頸。 然後，檢查每個層的最大輸入和輸出頻寬。

#### <a name="quick-evaluation"></a>快速評估

讓我們先假設某些預設設定簡化評估： 

- WebSocket 傳輸類型。
- 訊息大小是 2,048 個位元組。
- 每 1 秒時，會傳送訊息。
- Azure SignalR 服務是在預設的模式。

每個層都有自己的頻寬上限輸入和輸出頻寬。 流暢的使用者體驗不保證之後輸入或輸出連線超過限制。

**Echo**提供的最大輸入的頻寬，因為它有最低路由的成本。 **廣播**定義輸出訊息的最大頻寬。

請勿*不*超過在下列兩個資料表中反白顯示的值。

|       回應                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **輸入的頻寬** | **2 MBps**    | **4 MBps**    | **10 MBps**   | **20 MBps**    | **40 MBps**    | **100 MBps**   | **200 MBps**    |
| 輸出頻寬 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |


|     廣播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 輸入的頻寬  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps    |
| **輸出頻寬** | **4 MBps**    | **8 MBps**    | **20 MBps**    | **40 MBps**    | **80 MBps**    | **200 MBps**    | **400 MBps**   |

*輸入頻寬*並*輸出頻寬*是每秒總訊息大小。  以下是這些公式：
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *inboundConnections*:傳送訊息的連線數目。

- *outboundConnections*:接收訊息的連線數目。

- *messageSize*:單一訊息 （平均值） 的大小。 小型訊息的小於 1,024 個位元組有 1,024 位元組訊息類似的效能影響。

- *SendInterval*:傳送一則訊息的時間。 通常，它會是 1 秒，每個訊息，這表示每秒傳送一則訊息。 較小的間隔表示之時間週期內傳送更多的訊息。 例如，每則訊息 0.5 秒表示每秒傳送兩則訊息。

- *連線*：認可上限臨界值 Azure SignalR 服務的每個層。 如果連線數目增加更進一步，它會造成連線節流。

#### <a name="evaluation-for-complex-use-cases"></a>評估複雜的使用案例

##### <a name="bigger-message-size-or-different-sending-rate"></a>較大訊息大小或不同的傳送速率

實際使用案例是更複雜。 它可能會傳送一則訊息超過 2,048 個位元組，或傳送的訊息速率是每秒不一則訊息。 讓我們看 Unit100 的廣播，做為範例來了解如何評估其效能。

下表顯示的實際使用案例**廣播**。 但訊息大小、 連接計數和訊息傳送速率會不同於我們在上一節中的假設。 問題是如何我們可以推算任何這些項目 （訊息大小、 連接計數或訊息的傳送速率） 如果我們知道只有兩個。

| 廣播  | 訊息大小 | 每秒的輸入的訊息 | 連線 | 傳送間隔 |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 KB                | 1                        | 100,000     | 5 秒                      |
| 2 | 256 KB               | 1                        | 8,000       | 5 秒                      |

下列公式很容易推斷根據上述的公式：

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

輸出頻寬上限 Unit100，從上表為 400 MB。 20 KB 的訊息大小，傳出的連線數目上限應該 400MB \* 5 / 20 KB = 100000，其符合實際的值。

##### <a name="mixed-use-cases"></a>混合的使用案例

實際使用案例通常混合的四個基本的使用案例在一起： **echo**，**廣播**，**傳送至群組**，並**傳送給連接**。 您用來評估容量的方法是：

1. 混合的使用案例分成四個基本的使用案例。
1. 分別使用上述的公式來計算的輸入和輸出訊息的最大頻寬。
1. 若要取得的總計的最大輸入/輸出頻寬的頻寬計算的總和。 

會挑選適當的層，從最大輸入/輸出頻寬資料表。

> [!NOTE]
> 將訊息傳送至數百或數千個小型群組，或用戶端傳送訊息給彼此的數千個，路由的成本會變成主要。 採取這種影響列入考量。

將訊息傳送至用戶端的使用案例，請確定應用程式伺服器*不*瓶頸。 下列 「 個案研究 」 一節會提供指導方針在您需要多少應用程式伺服器和伺服器連線數目，您應該設定。

## <a name="case-study"></a>案例研究

瀏覽的 WebSocket 傳輸的四個一般使用案例的下列各節： **echo**，**廣播**，**傳送至群組**，和**傳送給連接**. 每個案例中，區段會列出 Azure SignalR 服務目前的輸入和輸出容量。 它也會說明會影響效能的主要因素。

在預設模式中，應用程式伺服器建立與 Azure SignalR 服務的五個伺服器連線。 應用程式伺服器預設會使用 Azure SignalR 服務 SDK。 在下列效能測試結果中，伺服器連接會增加到 15 （或以上的廣播，並將訊息傳送至大群組）。

不同的使用案例有不同的需求，應用程式伺服器。 **廣播**需要少量的應用程式伺服器。 **Echo**或是**傳送給連接**需要許多應用程式伺服器。

在所有使用案例，預設的訊息大小是 2,048 個位元組，，訊息傳送間隔為 1 秒。

### <a name="default-mode"></a>預設模式

在預設的模式涉及用戶端、 web 應用程式伺服器，以及 Azure SignalR 服務。 每個用戶端代表單一連線。

#### <a name="echo"></a>回應

首先，web 應用程式會連接到 Azure SignalR 服務。 其次，許多用戶端連接到 web 應用程式，將用戶端重新導向至 Azure SignalR 服務的存取權杖和端點。 然後，用戶端建立與 Azure SignalR 服務的 WebSocket 連線。

所有用戶端建立連接之後，它們會開始傳送包含時間戳記到特定的中樞每秒的訊息。 中樞會回應回到其原始的用戶端的訊息。 當它收到回應訊息傳回，每個用戶端就會計算延遲。

在下列圖表中，5 到 8 （紅色反白顯示的流量） 會在迴圈中。 迴圈執行的預設持續時間內 （5 分鐘），並取得的所有訊息延遲統計資料。

![回應的使用案例的流量](./media/signalr-concept-performance/echo.png)

行為**echo**判斷最大輸入的頻寬等於最大的輸出頻寬。 如需詳細資訊，請參閱下表。

|       回應                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 每秒輸入/輸出訊息 | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 輸入/輸出頻寬 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |

在此使用案例，每個用戶端會叫用應用程式伺服器中定義的中樞。 中樞只會呼叫原始用戶端中所定義的方法。 此中樞是最為輕量中樞**echo**。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使是針對這個簡單的中樞，應用程式伺服器上的流量壓力是做為重要**echo**輸入訊息負載增加。 此流量壓力需要大型的 SKU 層的許多應用程式伺服器。 下表列出的每個層的應用程式伺服器計數。


|    回應          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 用戶端連線數字，訊息大小，訊息傳送速率、 SKU 層和應用程式伺服器的 CPU/記憶體會影響整體效能**echo**。

#### <a name="broadcast"></a>廣播

針對**廣播**，當 web 應用程式收到訊息時，它會廣播到所有用戶端。 有更多的用戶端會廣播到所有用戶端沒有更多的訊息流量。 請參閱下圖。

![廣播的使用案例的流量](./media/signalr-concept-performance/broadcast.png)

少量的用戶端中進行廣播。 輸入的訊息頻寬很小，但是輸出頻寬很龐大。 外寄訊息頻寬會隨著用戶端連線或廣播的率增加幅度。

下表摘要說明的最大的用戶端連線、 輸入/輸出的訊息計數和頻寬。

|     廣播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒的輸入的訊息  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒的輸出訊息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸入的頻寬  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     |
| 輸出頻寬 | 4 MBps   | 8 MBps   | 20 MBps   | 40 MBps   | 80 MBps   | 200 MBps   | 400 MBps   |

張貼訊息廣播用戶端可以是不超過四個。 他們需要較少的應用程式伺服器相較於**echo**因為傳入的訊息量很小。 兩個應用程式伺服器已足夠的 SLA 和效能考量。 但是，您應該增加預設的伺服器連接，以避免發生不平衡，特別是針對 Unit50 和 Unit100。

|   廣播      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 增加從 5 到 40，以避免可能的不平衡的伺服器連線到 Azure SignalR 服務的每個應用程式伺服器上的預設伺服器連線。
>
> 用戶端連接數目、 訊息大小、 訊息傳送速率和 SKU 層會影響整體效能**廣播**。

#### <a name="send-to-group"></a>傳送至群組

**傳送至群組**使用案例有類似的流量模式**廣播**。 差別在於，用戶端建立與 Azure SignalR 服務的 WebSocket 連線之後，他們必須加入群組，才能傳送訊息至特定的群組。 下圖說明的流量。

![流量傳送至群組的使用案例](./media/signalr-concept-performance/sendtogroup.png)

群組成員和群組計數的兩個因素會影響效能。 若要簡化分析，我們定義兩種群組：

- **小型群組**:每個群組會有 10 個連接。 群組數目等於 （最大的連線計數） / 10。 比方說，對於 Unit1，如果 1000 的連接計數，然後我們需要在 1000年 / 10 = 100 的群組。

- **大型群組**:群組數目一律為 10。 群組成員計數等於 （最大的連線計數） / 10。 比方說，Unit1，如果有 1000 的連接計數，然後每個群組具有 1000年 / 10 = 100 位成員。

**傳送至群組**會路由至 Azure SignalR 服務成本，因為必須先尋找透過分散式的資料結構的目標連接。 當傳送連線增加時，會增加成本。

##### <a name="small-group"></a>小型群組

路由的成本值得將訊息傳送至許多小型的群組。 目前，Azure SignalR 服務實作會叫用 Unit50 路由成本限制。 新增更多的 CPU 和記憶體問題未解決，因此無法改善 Unit100 進一步所設計。 如果您需要更多輸入的頻寬，請連絡客戶支援。

|   傳送給小組     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 群組成員的計數        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 群組計數               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 每秒的輸入的訊息  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 輸入的頻寬  | 400 KBps  | 800 KBps  | 2 MBps     | 5 MBps     | 8 MBps     | 14 MBps    | 14 MBps     |
| 每秒的輸出訊息 | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70,000 | 70,000  |
| 輸出頻寬 | 4 MBps    | 8 MBps    | 20 MBps    | 50 MBps     | 80 MBps    | 140 MBps   | 140 MBps    |

許多用戶端連線呼叫中樞，讓應用程式伺服器數目也很重要的效能。 下表列出建議的應用程式伺服器計數。

|  傳送給小組   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 用戶端連線數字，訊息大小，訊息傳送速率、 路由成本、 SKU 層和應用程式伺服器的 CPU/記憶體會影響整體效能**傳送給小組**。

##### <a name="big-group"></a>巨量的群組

針對**傳送至大群組**，輸出頻寬成為瓶頸，才能達到路由成本限制。 下表列出的最大的輸出頻寬，也就是幾乎完全相同，如**廣播**。

|    傳送至大群組      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 群組成員的計數        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 群組計數               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 每秒的輸入的訊息  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 輸入的頻寬  | 80 KBps   | 40 KBps   | 40 KBps    | 20 KBps    | 40 KBps    | 40 KBps     | 40 KBps     |
| 每秒的輸出訊息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸出頻寬 | 8 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

傳送的連接計數為不超過 40。 Web 應用程式建議的數目很少，所以很小，應用程式伺服器的負擔。

|  傳送至大群組  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 增加從 5 到 40，以避免可能的不平衡的伺服器連線到 Azure SignalR 服務的每個應用程式伺服器上的預設伺服器連線。
> 
> 用戶端連接數目、 訊息大小、 訊息傳送速率，路由的成本和 SKU 層會影響整體效能**傳送至大群組**。

#### <a name="send-to-connection"></a>傳送到連線

在 **傳送給連接**使用情況下，如果用戶端建立連線至 Azure SignalR 服務，每個用戶端會呼叫特殊的中樞，以取得他們自己的連線識別碼。 效能基準測試會收集所有的連線識別碼、 洗牌，以及重新它們指派給所有的用戶端中，做為傳送的目標。 用戶端在效能測試完成之前，保留傳送訊息至目標連接。

![流量傳送到用戶端使用案例](./media/signalr-concept-performance/sendtoclient.png)

路由成本**傳送給連接**類似的成本**傳送給小組**。

當連線計數增加時，路由的成本會限制整體效能。 Unit50 已達到限制。 如此一來，無法進一步改善 Unit100。

下表的統計摘要之後執行的許多重試回合**傳送給連接**基準測試。

|   傳送到連線   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 連線                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 每秒輸入/輸出訊息 | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 輸入/輸出頻寬 | 2 MBps    | 4 MBps    | 10 MBps   | 16 MBps    | 18 MBps    | 40 MBps       | 40 MBps       |

這個使用案例都需要應用程式伺服器端上的高負載。 請參閱建議的應用程式伺服器下表中的計數。

|  傳送到連線  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 用戶端連線數字，訊息大小，訊息傳送速率、 路由成本、 SKU 層和 CPU/記憶體的應用程式伺服器會影響整體效能**傳送給連接**。

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET SignalR echo 廣播，並傳送給小組

Azure SignalR 服務提供相同的效能處理能力，為 ASP.NET SignalR。 

效能測試會使用從 Azure Web Apps[標準服務方案 S3](https://azure.microsoft.com/pricing/details/app-service/windows/)為 ASP.NET SignalR。

下表提供建議的 web 應用程式計數為 ASP.NET SignalR **echo**。

|   回應           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

下表提供建議的 web 應用程式計數為 ASP.NET SignalR**廣播**。

|  廣播       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

下表提供建議的 web 應用程式計數為 ASP.NET SignalR**傳送給小組**。

|  傳送給小組     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連線      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>無伺服器模式

在無伺服器的模式涉及用戶端和 Azure SignalR 服務。 每個用戶端代表單一連線。 用戶端會將透過 REST API 的訊息傳送至所有其他的用戶端或廣播訊息。

傳送高密度的訊息，透過 REST API 不成使用效率比使用 WebSocket。 它會要求您建置新的 HTTP 連接每次，而這是額外成本以無伺服器的模式。

#### <a name="broadcast-through-rest-api"></a>廣播透過 REST API
所有用戶端建立與 Azure SignalR 服務的 WebSocket 連線。 然後一些用戶端會開始透過 REST API 的廣播。 （輸入） 傳送的訊息是透過 HTTP Post，效率不相較於 WebSocket。

|   廣播透過 REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒的輸入的訊息  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒的輸出訊息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸入的頻寬  | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     | 4 KBps     | 4 KBps      | 4 KBps      |
| 輸出頻寬 | 4 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

#### <a name="send-to-user-through-rest-api"></a>傳送給使用者，透過 REST API
基準測試會將使用者名稱指派給所有的用戶端中，然後再開始連接到 Azure SignalR 服務。 用戶端建立與 Azure SignalR 服務的 WebSocket 連線之後，他們開始傳送訊息給其他人，透過 HTTP Post。

|   傳送給使用者，透過 REST API | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連線               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒的輸入的訊息  | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000  |
| 每秒的輸出訊息 | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000 |
| 輸入的頻寬  | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |
| 輸出頻寬 | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |

## <a name="performance-test-environments"></a>效能測試環境

針對所有使用稍早所列的情況下，我們進行效能測試，在 Azure 環境中。 我們最多使用 50 個用戶端 Vm 和 20 應用程式伺服器 Vm。 以下是一些詳細資料：

- 用戶端 VM 大小：StandardDS2V2 （2 個 vCPU，7g 記憶體）

- 應用程式伺服器 VM 大小：StandardF4sV2 （4 個 vCPU，8g 記憶體）

- Azure SignalR SDK 伺服器連線：15

## <a name="performance-tools"></a>效能工具

您可以在 Azure SignalR 服務找到效能工具[GitHub](https://github.com/Azure/azure-signalr-bench/tree/master/SignalRServiceBenchmarkPlugin)。

## <a name="next-steps"></a>後續步驟

在本文中，您可以取得 Azure SignalR 服務效能，在一般使用案例的概觀。

若要取得詳細資料的服務，並調整其內部項目上，閱讀下列指南：

* [Azure SignalR 服務內部項目](signalr-concept-internals.md)
* [Azure SignalR 服務調整](signalr-howto-scale-multi-instances.md)
