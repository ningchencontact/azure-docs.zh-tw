---
title: Azure 上的微服務簡介
description: 概述在現代應用程式開發中，為何使用微服務方法建置雲端應用程式很重要，以及 Azure Service Fabric 如何提供平台以達成此目標。
ms.topic: conceptual
ms.date: 06/18/2019
ms.openlocfilehash: e23c571d2000b5565da018d6ddf70a6388cb9226
ms.sourcegitcommit: f4f626d6e92174086c530ed9bf3ccbe058639081
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/25/2019
ms.locfileid: "75466315"
---
# <a name="why-use-a-microservices-approach-to-building-applications"></a>為何要使用微服務方法來建立應用程式？

對於軟體發展人員而言，將應用程式分解成元件部分並不是新的。 一般而言，會使用階層式方法，搭配後端存放區、中介層商務邏輯和前端使用者介面（UI）。 過去幾年來，這是開發人員針對雲端建立分散式應用程式*的變更。*

以下是一些不斷變化的商務需求：

* 大規模建立和運作的服務，可觸及新地理區域中的客戶。
* 更快速地傳遞特性和功能，以靈活的方式回應客戶需求。
* 提高資源使用率來降低成本。

這些商務需求會影響我們「如何」 建置應用程式。

如需 Azure 微服務方法的詳細資訊，請參閱[微服務：雲端提供的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)。

## <a name="monolithic-vs-microservices-design-approach"></a>整合型與微服務設計方法

應用程式會隨著時間而演化。 成功的應用程式因為有實用性而演化。 不成功的應用程式不會進化，而且最終會被取代。 以下是問題：您目前對需求的瞭解有多少，以及未來將會有什麼？ 例如，假設您正在為公司中的部門建立報告應用程式。 您確定應用程式只適用于您公司的範圍內，而且報告將不會保留長時間。 您的方法與建立可將影片內容傳遞給數十萬名客戶的服務不同。

有時候，以概念證明的形式取得門，是驅動因素。 您知道可以稍後重新設計應用程式。 幾乎不會使用太多工程的東西。 另一方面，當公司為雲端打造時，預期會有成長和使用量。 成長和規模無法預測。 我們想要快速建立原型，同時也知道我們的路徑可以處理未來的成功。 這是精簡的創業方法：建置、測量、學習及反覆執行。

在用戶端/伺服器時代，我們比起專注于使用每一層中的特定技術來建立分層應用程式。 整合型*應用程式*一詞是用來描述這些方法。 介面通常存在於各層之間，而在各層內的元件之間採用更緊密結合的設計。 開發人員會設計和分解已編譯成程式庫的類別，並將其結合成一些可執行檔和 Dll。

整合型設計方法有其優點。 整合型應用程式通常較容易設計，而且元件之間的呼叫速度會更快，因為這些呼叫通常是過度處理序間通訊（IPC）。 此外，每個人都會測試單一產品，這通常是使用人力資源的更有效率。 缺點是分層層之間有緊密的結合，而且您無法調整個別的元件。 如果您需要進行修正或升級，您必須等候其他人完成測試。 很難靈活。

微服務解決這些缺點，更密切配合上述的商務需求。 但它們也有其優點和責任。 微服務的優點在於其通常會封裝較簡單的商務功能，因此您可以獨立地對它們進行相應增加或減少、測試、部署，以及管理。 微服務方法的其中一項重要優點是，小組在商務案例方面的發展，與技術不同。 較小的團隊會根據客戶案例來開發微服務，並使用他們想要使用的任何技術。

換句話說，組織不需要為了維護微服務應用程式而將技術標準化。 擁有服務的個別團隊可以根據團隊的專業知識，或什麼是最適合所要解決的問題，各自發揮所長。 實際上，最好是一組建議的技術，例如特定的 NoSQL 存放區或 web 應用程式架構。

微服務的缺點是您必須管理更多不同的實體，並處理更複雜的部署和版本控制。 微服務之間的網路流量會隨著對應的網路延遲而增加。 許多多對話、細微的服務可能會造成效能上的麻煩。 如果沒有工具可協助您查看這些相依性，則很難看到整個系統。

標準可讓微服務方法的運作方式，是指定如何與服務通訊，而不是只容許您需要的專案，而不是嚴格的合約。 請務必在設計中預先定義這些合約，因為服務會彼此獨立地更新。 另一個在設計微服務方法時出現的描述是「細緻的服務導向架構 (SOA)」。

***最簡單的是，微服務設計方法是關於服務的分離聯盟，並獨立變更每個和同意的通訊標準。***

隨著越來越多的雲端應用程式產生，人們發現這種將整體應用程式分解成獨立、案例導向的服務，是比較好的長期方法。

## <a name="comparison-between-application-development-approaches"></a>應用程式開發方法的比較

![Service Fabric 平台應用程式開發][Image1]

1) 整合型應用程式包含特定領域的功能，而且通常會分成功能層，例如 web、商務和資料。

2) 您可以將整合型應用程式複製到多個伺服器/虛擬機器/容器，藉以進行調整。

3) 微服務應用程式會將個別功能分隔成個別較小的服務。

4) 微服務方法可獨立部署每個服務而相應放大，跨伺服器/虛擬機器/容器建立這些服務的執行個體。

使用微服務方法進行設計並不適用于所有專案，但會更密切地配合先前所述的商業目標。 如果您知道您會有機會在稍後將程式碼重新撰寫成微服務的設計，從整合型方法開始可能會有意義。 較常見的情況是您從單體式應用程式開始著手，然後從需要更高調整性或靈活度的功能領域開始，分階段緩慢地將它拆解。

當您使用微服務方法時，您會撰寫許多小型服務的應用程式。 這些服務會在跨機器叢集部署的容器中執行。 較小的小組會開發著重于案例的服務，並獨立測試、版本、部署及調整每個服務，讓整個應用程式得以進化。

## <a name="what-is-a-microservice"></a>什麼是微服務？

有不同的微服務定義。 但大部分的微服務特性都已廣泛接受：

* 封裝客戶或商務案例。 您解決什麼問題？
* 由小型工程團隊開發。
* 以任何程式設計語言撰寫，並使用任何架構。
* 包含程式碼和選擇性的狀態，兩者都是獨立的版本設定、部署和調整。
* 透過定義完善的介面和通訊協定，與其他微服務互動。
* 具有用來解析其位置的唯一名稱（Url）。
* 在失敗時維持一致且可用的。

若要加總：

***微服務應用程式是由獨立控制版本和可調整的客戶焦點式服務所組成，這些服務透過標準通訊協定和定義完善的介面彼此通訊。***

### <a name="written-in-any-programming-language-using-any-framework"></a>以任何程式設計語言撰寫，並使用任何架構

身為開發人員，我們想要根據我們的技能和所建立服務的需求，自由選擇語言或架構。 在某些服務中，您可以將C++上述任何其他專案的效能優勢價值。 對於其他人而言，您從C#或 JAVA 取得的輕鬆管理開發，可能會比較重要。 在某些情況下，您可能需要使用特定的合作夥伴程式庫、資料儲存技術，或向用戶端公開服務的方法。

選擇技術之後，您需要考慮服務的營運或生命週期管理和調整。

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>允許獨立控制版本、部署及調整的程式碼和狀態

無論您撰寫微服務的方式為何，程式碼和選擇性的狀態都應該獨立部署、升級及調整。 這個問題很難解決，因為這是您選擇的技術。 若要進行調整，瞭解如何分割（或分區）程式碼和狀態是一項挑戰。 當程式碼和狀態使用不同的技術時（通常是常見的），微服務的部署腳本必須能夠同時調整兩者。 這種區隔也是彈性和彈性，因此您可以升級某些微服務，而不需要一次升級所有的。

讓我們回到我們一段時間的整合型和微服務方法的比較。 下圖顯示儲存狀態之方法的差異：

#### <a name="state-storage-for-the-two-approaches"></a>這兩種方法的狀態儲存體

![Service Fabric 平台狀態儲存體][Image2]

***左側的整合式方法有單一資料庫和特定技術的層級。***

***右邊的微服務方法有一個互連的微服務圖形，其中狀態通常是以微服務為範圍，並使用各種技術。***

在單體式方法中，應用程式通常會使用單一資料庫。 使用一個資料庫的優點是它位於單一位置，可讓您輕鬆部署。 每個元件可以有單一資料表來儲存其狀態。 挑戰之處在於團隊必須嚴格區分狀態。 不一定，有人會想要將資料行新增至現有的客戶資料表、在資料表之間進行聯結，以及在儲存層建立相依性。 發生這種情況後，您無法調整個別的元件。

在微服務方法中，每個服務都會管理並儲存自己的狀態。 每個服務負責同時調整程式碼和狀態，以滿足服務的需求。 缺點是，當您需要建立應用程式資料的視圖或查詢時，您需要跨多個狀態存放區進行查詢。 這個問題通常是透過在微服務集合中建立視圖的個別微服務來解決。 如果您需要對資料執行多個即席查詢，您應該考慮將每個微服務的資料寫入資料倉儲服務，以進行離線分析。

已建立版本的微服務。 微服務的不同版本可能會並存執行。 較新的微服務版本可能會在升級期間失敗，而且需要回復為較舊的版本。 版本控制也有助於 A/B 測試，其中不同的使用者會遇到不同版本的服務。 例如，升級一組特定客戶的微服務來測試新功能，然後再更廣泛地推出，這是很常見的情況。

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>透過定義完善的介面和通訊協定，與其他微服務互動

過去10年來，已發佈廣泛的資訊，說明服務導向架構中的通訊模式。 一般而言，服務通訊使用 REST 方法，並搭配 HTTP 和 TCP 通訊協定及 XML 或 JSON 做為序列化格式。 從介面的觀點來看，它是關於採用 web 設計方法。 但什麼都不應該阻止您使用二進位通訊協定或您自己的資料格式。 請注意，如果這些通訊協定和格式不是公開提供的，人們會更難使用您的微服務。

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>具有可用來解析位置的唯一名稱 (URL)

只要您的微服務正在執行，就必須是可定址的。 如果您想要瞭解電腦，以及哪一部正在執行特定的微服務，則可能很快就會有問題。

就像 DNS 會解析特定電腦的特定 URL 一樣，微服務需要有唯一的名稱，其目前所在的位置才可被探索。 微服務需要可定址的名稱，獨立于其執行所在的基礎結構。 這表示服務的部署方式與探索方式之間會有互動，因為需要有服務登錄。 當電腦故障時，登錄服務必須告訴您服務的移動位置。

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>失敗時維持一致且可用

處理非預期的失敗是最難解決的問題之一，特別是在分散式系統中。 我們以開發人員撰寫的大部分程式碼都是用來處理例外狀況。 在測試期間，我們也會花費最多的時間來處理例外狀況。 此程式比撰寫程式碼來處理失敗更複雜。 當微服務執行所在的電腦失敗時，會發生什麼事？ 您必須偵測失敗，這是它本身的一個困難問題。 但您也需要重新開機微服務。

針對可用性，微服務必須能夠復原失敗，並可在另一部電腦上重新開機。 除了這些復原需求以外，資料也不會遺失，而且資料必須保持一致。

如果在應用程式升級期間發生失敗，會使復原性很難達成。 在搭配部署系統一起運作時，微服務不需要復原。 它需要判斷它是否可以繼續移至較新的版本，或回復為舊版，以維持一致的狀態。 您必須考慮幾個問題，例如是否有足夠的電腦可繼續向前移動，以及如何復原舊版的微服務。 若要進行這些決策，您需要微服務來發出健全狀況資訊。

### <a name="reports-health-and-diagnostics"></a>報告狀況和診斷

看起來似乎很明顯，而且通常會被忽略，但微服務需要報告其健康情況和診斷。 否則，您將無法從作業觀點瞭解其健全狀況。 相互關聯一組獨立服務上的診斷事件，並處理電腦時間差異以了解事件順序，是一件非常具挑戰性的任務。 與您透過同意的通訊協定和資料格式來與微服務互動相同，您需要將健康情況和診斷事件的記錄方式標準化，因為這些事件最後會被放入事件存放區中以供查詢和檢視。 使用微服務方法時，不同的小組必須同意單一記錄格式。 需要有一致的方法可檢視整個應用程式中的診斷事件。

狀況與診斷不同。 健全狀況是指微服務報告其目前狀態，以便採取適當的行動。 使用升級和部署機制來維護可用性是一個很好例子。 雖然服務目前可能因進程損毀或機器重新開機而狀況不良，但服務可能仍在運作中。 您所需的最後一件事是開始升級，讓情況更糟。 最好的方法是先進行調查，或等待微服務復原的時間。 微服務的健全狀況事件可協助我們做出明智的決策，實際上有助於建立自我修復的服務。

## <a name="guidance-for-designing-microservices-on-azure"></a>在 Azure 上設計微服務的指引 
如需在[azure 上設計和建立微服務](https://docs.microsoft.com/azure/architecture/microservices/)的指引，請造訪 azure 架構中心。

## <a name="service-fabric-as-a-microservices-platform"></a>Service Fabric 做為微服務平台

當 Microsoft 從傳遞盒裝產品（通常是整合型）到提供服務時，就會發生 Azure Service Fabric。 建立和操作大型服務的經驗，例如 Azure SQL Database 和 Azure Cosmos DB，塑造 Service Fabric。 平臺會隨著時間採用，而演變成更多的服務。 Service Fabric 不僅必須在 Azure 中執行，也必須在獨立式 Windows Server 部署中執行。

***Service Fabric 的目的是要解決建立和執行服務的困難問題，並有效率地使用基礎結構資源，讓小組可以使用微服務方法來解決商務問題。***

Service Fabric 透過提供下列項目，來協助您使用微服務方法建置應用程式：

* 一個提供系統服務的平台 - 這些服務可進行部署、升級、偵測及重新啟動失敗的服務、探索服務、路由傳送訊息、管理狀態，以及監視健康情況。
* 能夠部署在容器或進程中執行的應用程式。 Service Fabric 是一個容器和處理序協調者。
* 具生產力的程式設計 Api，可協助您以微服務的方式建立應用程式： [ASP.NET Core、Reliable Actors 和 Reliable Services](service-fabric-choose-framework.md)。 例如，您可以取得健康情況和診斷資訊，或利用內建的高可用性。

***Service Fabric 與您建立服務的方式無關，您可以使用任何技術。但它會提供內建的程式設計 Api，讓您更輕鬆地建立微服務。***

### <a name="migrating-existing-applications-to-service-fabric"></a>將現有的應用程式移轉到 Service Fabric

Service Fabric 可讓您重複使用現有的程式碼，並使用新的微服務將其現代化。 應用程式現代化有五個階段，您可以在任何階段開始和停止。 這些階段包括：

1) 開始使用傳統單體式應用程式。  
2) 移動. 使用容器或來賓可執行檔，將現有的程式碼裝載在 Service Fabric 中。  
3) 之. 將新的微服務與現有的容器化程式碼一起加入。  
4) 創新。 根據需求將整合型應用程式分解成微服務。  
5) 將應用程式轉換成微服務。 轉換現有的整合型應用程式，或建立新的 greenfield 應用程式。

![遷移至微服務][Image3]

請記住，您可以*在任何階段開始和停止*。 您不需要進行下一個階段。 

讓我們看看每個階段的範例。

**移轉**  
基於兩個原因，許多公司會將現有的整合型應用程式遷移到容器中：

* 降低成本，這可能是因為現有硬體的匯總和移除，或因為以較高的密度執行應用程式所造成。
* 開發與作業之間的一致部署合約。

成本縮減非常簡單。 在 Microsoft，許多現有的應用程式正在進行容器化，因而節省了數百萬美元的費用。 一致的部署比較難評估，但同樣重要。 這表示開發人員可以選擇適合的技術，但作業只會接受單一方法來部署和管理應用程式。 它會減輕作業，使其不需要處理支援不同技術的複雜性，而不會強迫開發人員只選擇特定的技術。 基本上，每個應用程式都會容器化成獨立的部署映射。

許多組織都在此停止。 他們已經有容器的優點，Service Fabric 提供完整的管理經驗，包括部署、升級、版本控制、復原和健康狀態監視。

**現代化**  
現代化是隨著現有的容器化程式碼加入新服務。 如果您要撰寫新的程式碼，最好是在微服務路徑下執行較小的步驟。 這可能表示加入新的 REST API 端點或新的商務邏輯。 如此一來，您就可以開始建立新的微服務，並練習開發和部署它們的程式。

**創新**  
微服務方式能容納持續變更的商務需求。 在這個階段，您必須決定是否要開始將整合型應用程式分割成服務，或進行創新。 這裡有一個典型的範例，就是當您用來做為工作流程佇列的資料庫變成處理瓶頸的時候。 隨著工作流程要求數目的增加，將需要分配工作來進行調整。 讓該應用程式不會進行調整，或是需要更頻繁地更新，並將其分割為微服務和創新。

**將應用程式轉換成微服務**  
在這個階段，您的應用程式會完全由（或分割）微服務組成。 為了達到此點，您已完成微服務旅程。 您可以從這裡開始，但沒有微服務平臺可協助您進行大量投資。

### <a name="are-microservices-right-for-my-application"></a>微服務適合我的應用程式嗎？

可能。 在 Microsoft 中，因為有越來越多團隊基於商業理由而開始為雲端打造，所以有許多人都實現了採用類似微服務的方法的優點。 例如，Bing 已使用微服務多年。 對於其他團隊而言，微服務方法很新穎。 團隊發現在他們的核心強項之外，還有需要解決的困難問題。 這就是為什麼 Service Fabric 獲得吸引服務的技術。

Service Fabric 的目標是要降低建立微服務應用程式的複雜性，讓您不需要經過太多成本重新設計時。 從小規模開始、需要時調整、淘汰服務、加入新服務，並隨客戶使用情況而演化。 我們也知道，為了讓微服務更易於為大部分開發人員所接受，還有許多其他尚待解決的問題。 容器和動作專案程式設計模型是該方向的小型步驟範例。 我們肯定會形成更多創新，讓微服務方法更容易。


## <a name="next-steps"></a>後續步驟

* [微服務︰採用雲端技術的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)
* [Azure 架構中心：在 Azure 上建立微服務](https://docs.microsoft.com/azure/architecture/microservices/)
* [Azure Service Fabric 應用程式和叢集最佳做法](service-fabric-best-practices-overview.md)
* [Service Fabric 術語概觀](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
