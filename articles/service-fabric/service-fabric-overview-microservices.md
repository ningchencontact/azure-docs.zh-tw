---
title: Azure 上的微服務簡介 | Microsoft Docs
description: 概述在現代應用程式開發中，為何使用微服務方法建置雲端應用程式很重要，以及 Azure Service Fabric 如何提供平台以達成此目標。
services: service-fabric
documentationcenter: .net
author: athinanthny
manager: chackdan
editor: ''
ms.assetid: fae2be85-0ab4-4cd3-9d1f-e0d95fe1959b
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/02/2017
ms.author: atsenthi
ms.openlocfilehash: 1e02e4fdf0dbe04d8756fc6355c6a9e414b27d2b
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/23/2019
ms.locfileid: "60719092"
---
# <a name="why-a-microservices-approach-to-building-applications"></a>为什么通过微服务的方法生成应用程序？

身為軟體開發人員，已熟悉思考如何將應用程式分解成元件部分。 通常是透過一種分層方法，有後端存放區、中間層商務邏輯和前端使用者介面 (UI)。 過去幾年來的變化，是身為開發人員的我們開始為雲端建置分散式應用程式。

變更的商務需求包括：

* 大規模建置和運作的服務，以便觸達位於新地理區域中的客戶。
* 更快速提供特色與功能，靈活地回應客戶的需求。
* 提高資源使用率來降低成本。

這些商務需求會影響我們「如何」  建置應用程式。

如需 Azure 使用微服務之方式的詳細資訊，請參閱 [Microservices:由云支持的应用程序变革](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)。

## <a name="monolithic-vs-microservice-design-approach"></a>單體式與微服務設計方法

應用程式會隨著時間而演化。 成功的應用程式因為有實用性而演化。 失敗的應用程式不會演化，最後會取代。 問題是：您對現今的需求了解多少，以及未來需求會有何變化？ 例如，假設您要建置某部門的報告應用程式。 您確定該應用程式僅適用於您公司的範圍內，並且報告為短期報告。 那麼，您選擇的方法就會與要建置將視訊內容傳遞給數千萬客戶的服務不同。

在已知後來可以重新設計應用程式的情況下，有時向外尋求概念證明才是驅動因素。 從來不用卻過度設計並沒有太大意義。 這就是一般所謂的工程取捨。 另一方面，公司談論建置雲端時都會期望成長和使用量。 問題在於無法預期成長和範圍。 我們想要能夠迅速建立原型，同時還要了解我們正在通往未來成功的路徑上。 這是精簡的創業方法：建置、測量、學習及反覆執行。

在主從架構的時代，我們傾向專注於建立分層式應用程式，每一層都採用特定的技術。 已針對這些方法衍生出「單體式」應用程式一詞。 介面通常存在於各層之間，而在各層內的元件之間採用更緊密結合的設計。 開發人員設計並分解類別，將類別編譯成程式庫，然後連結起來成為一些可執行檔和 DLL。 

這類單體式設計方法有一些優點。 其設計方式通常比較簡單，且元件之間的呼叫通常會透過處理序間通訊 (IPC) 進行而變得更快。 此外，每個人都只測試單一產品，人力資源運用更有效率。 缺點是分層式層級之間的結合緊密，以致您無法調整個別的元件。 如果您需要執行修正或升級，則必須等候其他人完成其測試。 灵活性更难以发挥。

微服務可解決這些缺點，更密切配合上述的商務需求，但它們本身也都有優缺點。 微服務的優點在於其通常會封裝較簡單的商務功能，因此您可以獨立地對它們進行相應增加或減少、測試、部署，以及管理。 微服務方法的一個重要優點，在於團隊會比較偏向由商務案例所驅動，而非如分層方法所建議的由技術驅動。 實際上，較小的團隊會採用他們選擇的任何技術，根據客戶案例來開發微服務。

換句話說，組織不需要為了維護微服務應用程式而將技術標準化。 擁有服務的個別團隊可以根據團隊的專業知識，或什麼是最適合所要解決的問題，各自發揮所長。 實際上，最好有一組建議的技術，例如特定的 NoSQL 存放區或 Web 應用程式架構。

微服务的缺点包括需要管理越来越多的独立实体、处理更复杂的部署和版本控制。 微服务之间的网络流量以及相应的网络延迟不断增加。 經過大量論述之後，可知細微的服務是效能夢魘的解決良方。 如果没有工具帮助查看这些依赖性，很难“看到”整个系统。

標準會讓微服務方法奏效、在通訊方式上達成共識，以及只在乎您需要從服務取得什麼，而不是僵固的合約。 必須在設計的初期定義這些聯繫，因為服務會各自獨立地更新。 另一個在設計微服務方法時出現的描述是「細緻的服務導向架構 (SOA)」。

***簡而言之，微服務設計方法是低耦合的服務同盟，各自獨立變更，並達成一致的通訊標準。***

隨著更多雲端應用程式的產生，人們發現這種將整體應用程式分解成獨立、以案例為焦點之服務的做法，在長期上是較好的方法。

## <a name="comparison-between-application-development-approaches"></a>應用程式開發方法的比較

![Service Fabric 平台應用程式開發][Image1]

1) 單體式應用程式包含領域特定功能，通常會依功能層來劃分，例如網路、商務和資料。

2) 單體式應用程式可藉由複製到多部伺服器/虛擬機器/容器上進行擴充。

3) 微服務應用程式會將個別功能分隔成個別較小的服務。

4) 微服務方法可獨立部署每個服務而相應放大，跨伺服器/虛擬機器/容器建立這些服務的執行個體。

使用微服務方法來設計並非所有專案的萬靈丹，但確實較符合稍早所述的商務目標。 如果您知道稍後將有機會將程式碼修改成微服務設計，或許可接受從單體方式開始著手。 較常見的情況是您從單體式應用程式開始著手，然後從需要更高調整性或靈活度的功能領域開始，分階段緩慢地將它拆解。

微服務方法代表您會以許多小型服務來組成應用程式。 這些服務會在部署於電腦叢集的容器中執行。 較小的團隊會開發著重於某個案例且獨立測試的服務、進行各服務的控制版本、部署和調整規模，所以應用程式可以整體演化。

## <a name="what-is-a-microservice"></a>什麼是微服務？

有不同的微服務定義。 但在微服務的下列大部分特性上，已廣泛達成共識：

* 封裝客戶或商務案例。 您要解決什麼問題？
* 由小型工程團隊開發。
* 使用任何程式設計語言撰寫並使用任何架構。
* 由獨立控制版本、部署及調整的程式碼和 (選擇性) 狀態所組成。
* 透過定義完善的介面和通訊協定，與其他微服務互動。
* 具有可用來解析位置的唯一名稱 (URL)。
* 在失敗時維持一致且可用的。

摘要說明：

***微服務應用程式是由獨立控制版本和可調整的客戶焦點式服務所組成，這些服務透過標準通訊協定和定義完善的介面彼此通訊。***

### <a name="written-in-any-programming-language-and-use-any-framework"></a>使用任何程式設計語言撰寫並使用任何架構。

身為開發人員，我們應該根據本身的技術或服務需求，自由選擇我們想要的語言或架構。 在某些服務中，您可能認為 C++ 的效能優點勝於一切。 在其他服務中，C# 或 Java 的簡易管理開發可能才是最重要的。 在某些情況下，您可能需要使用特定的合作夥伴程式庫、資料儲存技術，或向用戶端公開服務的方式。

在選擇技術之後，接下來就是服務的操作或生命週期管理和調整。

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>允許獨立控制版本、部署及調整的程式碼和狀態

不論您選擇何種方式來撰寫微服務，程式碼 (和選擇性的狀態) 都應該獨立地部署、升級及調整。 這是較難以解決的問題之一，因為這會涉及到您所選擇的技術。 在調整方面，很不容易了解如何分割 (或分區化) 程式碼和狀態。 當程式碼和狀態使用不同的技術時 (目前的普遍情況)，微服務的部署指令碼必須能夠同時調整兩者。 這也關乎靈活度和彈性，如此您就能升級部分微服務，而不需一次全部升級。

暫時回到單體式和微服務方法的比較，下圖顯示狀態儲存方法的差異。

#### <a name="state-storage-between-application-styles"></a>應用程式樣式之間的狀態儲存

![Service Fabric 平台狀態儲存體][Image2]

***左邊的單體式方法有單一資料庫和多層的特定技術。***

***右邊的微服務方法有圖形顯示互連的微服務，其中狀態通常以微服務為範圍，並會使用各種技術。***

在單體式方法中，應用程式通常會使用單一資料庫。 優點是這是單一位置，很容易部署。 每个组件可以通过单个表存储其状态。 挑戰之處在於團隊必須嚴格區分狀態。 無可避免地就想將新的資料行新增至現有的客戶資料表、在資料表之間執行聯結，以及對儲存層形成相依性。 發生這種情況後，您無法調整個別的元件。

在微服務方法中，每個服務都會管理並儲存自己的狀態。 每個服務負責同時調整程式碼和狀態，以滿足服務的需求。 缺點就是在需要建立應用程式資料的檢視或查詢時，您必須在多個狀態存放區上進行查詢。 為了解決此問題，通常是由一個獨立的微服務建置一個跨許多微服務的檢視。 如果您需要在資料上執行多個即席查詢，則每個微服務應該考慮將其資料寫入資料倉儲服務，供離線分析。

微服務會進行版本控制，且不同版本的微服務可能會並行執行。 新版本的微服務可能會在升級期間失敗，並需要被回復至較舊的版本。 版本控制也對執行 A/B 樣式測試很有幫助，其中不同的使用者會體驗到不同版本的服務。 比方說，在更廣泛推出新功能之前，通常會先針對一組特定的客戶升級微服務以測試新功能。

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>透過定義完善的介面和通訊協定，與其他微服務互動

在過去 10 年來所發佈的大量服務導向架構文獻中，皆已說明通訊模式。 一般而言，服務通訊會使用 REST 方法，並搭配 HTTP 和 TCP 通訊協定，以及 XML 或 JSON 作為序列化格式。 從介面觀點來看，這是有關採用 Web 設計方法。 但並不禁止您使用二進位通訊協定或您自己的資料格式。 如果這些通訊協定和格式無法公開取得，您的微服務會較難使用，要有心理準備。

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>具有可用來解析位置的唯一名稱 (URL)

微服務不論在何處執行，都必須可定址。 如果您正在考慮機器及哪一部要執行特定的微服務，很快就會陷入困境。 

就像 DNS 會解析特定電腦的特定 URL 一樣，微服務需要有唯一的名稱，其目前所在的位置才可被探索。 微服務需要有可定址的名稱，該名稱必須獨立於其執行所在的基礎結構。 這意味著服務的部署和探索方式之間會互相影響，因為需要有服務登錄。 當電腦故障時，登錄服務必須告訴您服務已移到哪個位置。

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>失敗時維持一致且可用

處理非預期的失敗是最難解決的問題之一，特別是在分散式系統中。 开发人员编写的代码大多是在处理异常，这也是测试时花费最多时间的地方。 問題比撰寫程式碼來處理失敗更複雜。 當執行微服務的電腦故障時，該怎麼辦？ 您不僅需要偵測此失敗 (本身就是棘手的問題)，還需要重新啟動微服務。

基於可用性的原因，微服務必須能夠從失敗中復原，並能在另一部電腦上重新啟動。 除了執行的程式碼必須具復原性之外，還不能發生任何資料遺失的情況，且資料必須保持一致。

如果在應用程式升級期間發生失敗，會使復原性很難達成。 在搭配部署系統一起運作時，微服務不需要復原。 它需要判斷是否可以繼續升級到較新版本，還是復原為舊版來維護一致的狀態。 需要考慮一些問題，例如，是否有足夠的電腦可繼續升級，以及如何復原舊版的微服務。 這需要微服務發出健康情況資訊，才能做出這些決定。

### <a name="reports-health-and-diagnostics"></a>報告狀況和診斷

微服務必須報告其健全狀況和診斷，這一點看似明顯，但卻經常被輕忽。 如果沒這麼做，將會很難從作業觀點上取得其健康情況的見解。 相互關聯一組獨立服務上的診斷事件，並處理電腦時間差異以了解事件順序，是一件非常具挑戰性的任務。 與您透過同意的通訊協定和資料格式來與微服務互動相同，您需要將健康情況和診斷事件的記錄方式標準化，因為這些事件最後會被放入事件存放區中以供查詢和檢視。 在微服務方法中，讓不同團隊在單一記錄格式上取得同意是一件非常重要的事。 需要有一致的方法可檢視整個應用程式中的診斷事件。

狀況與診斷不同。 健全狀況是指微服務報告其目前狀態，以便採取適當的行動。 使用升級和部署機制來維護可用性是一個很好例子。 雖然目前服務可能由於處理序損毀或重新開機而狀況不良，但服務可能仍會運作。 不应该执行升级而让情况恶化。 最好是先進行調查，或讓微服務有時間復原。 微服務的健全狀況事件可協助我們做出明智的決策，實際上有助於建立自我修復的服務。

## <a name="service-fabric-as-a-microservices-platform"></a>Service Fabric 做為微服務平台

Azure Service Fabric 的出現，源自於 Microsoft 從提供盒裝產品 (通常是單體式) 轉換到提供服務。 建置和操作大型服務 (例如 Azure SQL Database、Azure Cosmos DB、圖形化 Service Fabric) 的經驗。 此平台已隨著越來越多的服務採用它而演化。 Service Fabric 不僅必須在 Azure 中執行，也必須在獨立式 Windows Server 部署中執行。

***Service Fabric 的目標是解決建置和執行服務方面的艱難問題，以及有效率地利用基礎結構資源，讓團隊可以使用微服務方法來解決商務問題。***

Service Fabric 透過提供下列項目，來協助您使用微服務方法建置應用程式：

* 一個提供系統服務的平台 - 這些服務可進行部署、升級、偵測及重新啟動失敗的服務、探索服務、路由傳送訊息、管理狀態，以及監視健康情況。
* 能够部署在容器中运行或作为进程运行的应用程序。 Service Fabric 是一個容器和處理序協調者。
* 具生產力的程式設計 API，以協助您將應用程式建置成微服務：[ASP.NET Core、Reliable Actors 及 Reliable Services](service-fabric-choose-framework.md)。 例如，您可以取得健康情況和診斷資訊，或利用內建的高可用性。

***Service Fabric 不會限制您建置服務的方式，您可以使用任何技術。不過，它提供可讓您輕鬆建置微服務的內建程式設計 API。***

### <a name="migrating-existing-applications-to-service-fabric"></a>將現有的應用程式移轉到 Service Fabric

Service Fabric 可讓您重複使用現有的程式碼，而這些程式碼可藉由新的微服務來進行現代化。 應用程式的現代化階段有五個，而您可以在任何階段開始和停止。 它們是：

1) 開始使用傳統單體式應用程式。  
2) 原封不動轉移 - 使用容器或客體可執行檔來裝載 Service Fabric 中現有的程式碼。  
3) 現代化 - 在現有的容器化程式碼之外，再加上新的微服務。  
4) 創新 - 將單體完全根據需求拆解成微服務。  
5) 轉換成微服務 - 轉換現有的單體式應用程式，或建置新的原創應用程式。

![移轉成微服務][Image3]

再重新強調一遍，您可以**在這當中任何階段開始和停止**。 不會被迫移至下一個階段。 現在，讓我們看看這每一個階段的範例。

**隨即轉移**  
有許多公司都將現有的單體式應用程式隨即轉移至容器中的原因有兩個：

- 降低成本，不論是透過合併和移除現有的硬體，或是透過以更高密度的方式執行應用程式。
- 開發與作業之間的一致性部署合約。

降低成本是可理解的，在 Microsoft 內，大量現有的應用程式都正透過容器化來節省數百萬美元。 一致性部署較難以評估，但同樣重要。 這表示開發人員仍可自由選擇適合他們的技術，不過，作業將只接受單一的方式來部署和管理這些應用程式。 它緩和了作業必須處理許多不同技術的複雜性，或是強制開發人員只能選擇特定技術的情況。 基本上，每個應用程式都會透過容器化成為獨立性部署映像。

許多組織都在此停止。 它們已經享有容器的好處，而且 Service Fabric 提供包含了部署、升級、版本設定、復原、健康情況監視等完整的管理體驗。

**現代化**  
在現有的容器化程式碼之外，再加上新的服務。 如果您要撰寫新的程式碼，最好是決定順著微服務的路徑步步為營。 這可能是新增新的 REST API 端點，或是新的商務邏輯。 如此一來，您便開始了建置新微服務的旅程，以及練習開發和部署這些微服務。

**創新**  
微服務方式能容納持續變更的商務需求。 在此階段，您必須決定是否應該開始將單體式應用程式分割成不同服務，還是應該進行創新。 其中一個範例，就是當作為工作流程佇列的資料庫，變成處理上的瓶頸時。 隨著工作流程要求數目的增加，將需要分配工作來進行調整。 針對該應用程式無法進行調整或需要頻繁更新的部分，請將它分割為微服務並進行創新。

**轉換成微服務**  
這是應用程式完全由微服務構成 (或解構成微服務) 的階段。 到此階段，您已完成微服務旅程。 您可以從這裡開始，但是在沒有微服務平台來協助您的情況下執行此操作會是相當大的投資。 

### <a name="are-microservices-right-for-my-application"></a>微服務適合我的應用程式嗎？

可能。 根據我們的經驗，隨著 Microsoft 中越來越多團隊基於商業理由開始針對雲端進行建置，有許多團隊都了解到採用類似微服務的方法所帶來的優點。 例如，Bing 多年來一直使用微服務進行開發。 對於其他團隊而言，微服務方法很新穎。 團隊發現在他們的核心強項之外，還有需要解決的困難問題。 這就是為什麼 Service Fabric 受到重視而成為建置服務的最佳技術。

Service Fabric 的目標是降低建置微服務應用程式的複雜性，讓您不需要經歷許多耗費成本的重新設計工作。 從小規模開始、需要時調整、淘汰服務、加入新服務，並隨客戶使用情況而演化。 我們也知道，為了讓微服務更易於為大部分開發人員所接受，還有許多其他尚待解決的問題。 容器和 Actor 程式設計模型都是朝此目標前進的一小步，我們確信將會浮現更多創新來輕鬆達成目標。
 
<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->

## <a name="next-steps"></a>後續步驟

* [Service Fabric 術語概觀](service-fabric-technical-overview.md)
* [微服務：採用雲端技術的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
