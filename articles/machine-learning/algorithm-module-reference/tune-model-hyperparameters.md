---
title: 調整模型超參數
titleSuffix: Azure Machine Learning
description: 瞭解如何使用 Azure Machine Learning 中的微調模型超參數模組，在模型上執行參數清除，以判斷最佳的參數設定。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/16/2019
ms.openlocfilehash: 3db20110571203588ac15f4f64a2ae0a6ab6ef27
ms.sourcegitcommit: f4f626d6e92174086c530ed9bf3ccbe058639081
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/25/2019
ms.locfileid: "75428398"
---
# <a name="tune-model-hyperparameters"></a>調整模型超參數

本文說明如何在 Azure Machine Learning 設計工具（預覽）中使用微調模型超參數模組。 目標是要判斷機器學習模型的最佳超參數。 此模組會使用不同的設定組合來建立及測試多個模型。 它會比較所有模型的計量，以取得設定的組合。 

詞彙*參數*和*超參數*可能會造成混淆。 您可以在 [屬性] 窗格中設定模型的*參數*。 基本上，此模組會對指定的參數設定執行*參數清理*。 它會學習一組最佳的_超參數_，這可能會因每個特定的決策樹、資料集或回歸方法而有所不同。 尋找最佳設定的程式有時也稱為「*微調*」。 

此模組支援下列方法來尋找模型的最佳設定：*整合式定型和微調。* 在此方法中，您會設定要使用的一組參數。 接著，您可以讓模組逐一查看多個組合。 此模組會測量精確度，直到找到「最佳」模型為止。 使用大部分的學習模組模組時，您可以選擇在定型程式期間應變更的參數，而且應該保持固定。

視您想要執行微調程式的時間長度而定，您可能會決定要徹底測試所有組合。 或者，您可以藉由建立參數組合的方格，並測試參數方格的隨機子集，來縮短程式。

這個方法會產生定型的模型，您可以儲存以供重複使用。  

> [!TIP] 
> 您可以執行相關工作。 開始微調之前，請套用特徵選取來判斷具有最高資訊值的資料行或變數。

## <a name="how-to-configure-tune-model-hyperparameters"></a>如何設定微調模型超參數  

學習機器學習模型的最佳超參數需要大量使用管線。

### <a name="train-a-model-by-using-a-parameter-sweep"></a>使用參數清除來定型模型  

本節說明如何執行基本的參數清除，這會使用微調模型超參數模組來訓練模型。

1.  將微調模型超參數模組加入至您在設計工具中的管線。

2.  將未定型的模型連接到最左邊的輸入。 

3. 將 [**建立定型模式]** 選項設定為 [**參數範圍**]。 使用**範圍**產生器來指定要在參數清除中使用的值範圍。  

    幾乎所有的分類和回歸模組都支援整合式參數清除。 對於不支援設定參數範圍的學習工具，您可以只測試可用的參數值。

    您可以手動設定一或多個參數的值，然後清除其餘的參數。 這可能會節省一些時間。

4.  加入您想要用於定型的資料集，並將它連接到微調模型超參數的中間輸入。  

    （選擇性）如果您有已加上標籤的資料集，您可以將它連接到最右邊的輸入埠（**選擇性的驗證資料集**）。 這可讓您在定型和微調時測量精確度。

5.  在 [微調模型超參數] 的 [**屬性**] 窗格中，選擇 [**參數清除模式]** 的值。 此選項可控制參數的選取方式。

    - **整個方格**：當您選取此選項時，模組會在系統預先定義的方格上進行迴圈，以嘗試不同的組合，並找出最佳的學習模組。 當您不知道最佳參數設定可能是什麼，而且想要嘗試所有可能的值組合時，這個選項就很有用。

    - **隨機**清除：當您選取此選項時，模組會隨機選取系統定義範圍的參數值。 您必須指定要讓模組執行的最大回合數。 當您想要使用您選擇的計量來增加模型效能，但仍保留運算資源時，這個選項很有用。    

6.  針對 [**標籤資料行**]，開啟 [資料行選取器] 來選擇單一標籤資料行。

7.  選擇執行次數：

    1. **隨機清除的最大執行數目**：如果您選擇隨機清除，可以使用隨機組合的參數值來指定模型應該定型多少次。

    2. **隨機方格上的最大執行數目**：此選項也會控制隨機取樣參數值的反復專案數，但不會從指定的範圍隨機產生值。 相反地，模組會建立所有可能的參數值組合的矩陣。 然後，它會透過矩陣進行隨機取樣。 這個方法更有效率，而且較不容易進列區域超取樣或 undersampling。

8.  針對 [**排名**]，選擇要用於排序模型的單一度量。

    當您執行參數清除時，此模組會計算模型類型的所有適用計量，並將其傳回至 [**清理結果**] 報告。 此模組會針對回歸和分類模型使用不同的計量。

    不過，您選擇的度量會決定模型的排名方式。 根據所選計量的排名，只有最上層的模型會輸出為要用於計分的定型模型。

9.  針對 [**隨機種子**]，輸入要用來啟動參數清除的數位。 

10. 執行管道。

## <a name="results-of-hyperparameter-tuning"></a>超參數微調的結果

訓練完成時：

+ 若要查看最佳模型的一組精確度計量，請以滑鼠右鍵按一下模組，選取 [**清理結果**]，然後選取 [**視覺化**]。

    輸出包含適用于模型類型的所有精確度標準，但您針對 [排名] 選取的計量會決定哪一種模型被視為「最佳」。

+ 若要在其他管線中使用模型進行評分，而不需要重複微調程式，請以滑鼠右鍵按一下模型輸出，然後選取 [**另存為定型模型**]。 


## <a name="technical-notes"></a>技術說明

本章節包含執行詳細資料和秘訣。

### <a name="how-a-parameter-sweep-works"></a>參數清理的運作方式

當您設定參數清理時，會定義搜尋範圍。 搜尋可能會使用隨機選取的有限數目參數。 或者，它可能會對您定義的參數空間進行徹底的搜尋。

+ **隨機**清除：此選項會使用設定的反復專案數來定型模型。 

  您可以指定要逐一查看的值範圍，而模組會使用隨機播放的那些值子集。 系統會選擇取代值，這表示先前隨機播放的數位不會從可用數目的集區中移除。 所以選取任何值的機會在所有階段都維持不變。  

+ **整個方格**：使用整個方格的選項表示會測試每個組合。 此選項是最完整的，但需要最多時間。 

### <a name="controlling-the-length-and-complexity-of-training"></a>控制訓練的長度和複雜度

逐一查看許多設定組合可能非常耗時，因此模組會提供數種方式來限制進程：

+ 限制用來測試模型的反覆運算次數。
+ 限制參數空間。
+ 同時限制反覆運算次數和參數空間。

我們建議您將設定為管線，以決定在特定資料集和模型上最有效率的訓練方法。

### <a name="choosing-an-evaluation-metric"></a>選擇評估度量

在測試結束時，此模型會呈現一份報告，其中包含每個模型的精確度，讓您可以查看度量結果：

- 所有的二元分類模型都會使用一組統一的計量。
- 精確度會用於所有多類別分類模型。
- 回歸模型會使用一組不同的計量。 

不過，在定型期間，您必須選擇*單一*計量，以便在微調程式期間產生的模型進行排序。 您可能會發現，最佳的計量會因您的商務問題以及誤報和誤否定的成本而有所不同。

#### <a name="metrics-used-for-binary-classification"></a>用於二元分類的計量

-   **精確度**是 true 結果與總案例的比例。  

-   **精確度**是 true 結果與正面結果的比例。  

-   **回想**是所有結果的所有正確結果的分數。  

-   **F 分數**是指平衡精確度和召回率的量值。  

-   **AUC**是一個值，表示在 X 軸上繪製誤報時，曲線下的區域，而實際的正值則繪製在 y 軸上。  

-   **平均記錄遺失**是兩個機率分佈之間的差異： true 1 和模型中的一個。  

#### <a name="metrics-used-for-regression"></a>用於回歸的計量

-   **平均絕對錯誤**：模型中所有錯誤的平均值，其中*error*表示預測值與 true 值的距離。 它通常縮寫為*MAE*。  

-   **Mean 平方誤差的方根**會測量誤差的平均值，然後取得該值的根。 通常縮寫為*RMSE*。  

-   **相對絕對錯誤**會將錯誤表示為 true 值的百分比。  

-   **相對平方誤差**會除以預測值的總平方誤差，以標準化總平方誤差。  

-   **決定係數**是單一數位，表示資料符合模型的程度。 值為1表示模型完全符合資料。 值若為零，表示資料是隨機的，否則無法配合模型。 這通常稱為*r<sup>2</sup>* 、 *r<sup>2</sup>* 或*r 平方*。  

### <a name="modules-that-dont-support-a-parameter-sweep"></a>不支援參數清理的模組

幾乎 Azure Machine Learning 中的所有學習工具都支援使用整合式參數清除進行交叉驗證，讓您選擇要與管線搭配使用的參數。 如果學習模組不支援設定某個範圍的值，您仍然可以在交叉驗證中使用它。 在此情況下，會針對清除選取允許的值範圍。 


## <a name="next-steps"></a>後續步驟

請參閱可用來 Azure Machine Learning 的[模組集合](module-reference.md)。 

