---
title: 交叉驗證模型：模組參考
titleSuffix: Azure Machine Learning
description: 瞭解如何在 Azure Machine Learning 中使用交叉驗證模型模組，藉由分割資料來交叉驗證分類或回歸模型的參數估計值。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/10/2019
ms.openlocfilehash: b7c898c232dc39398b13f16beea814aa4e554845
ms.sourcegitcommit: f4f626d6e92174086c530ed9bf3ccbe058639081
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/25/2019
ms.locfileid: "75428553"
---
# <a name="cross-validate-model"></a>交叉驗證模型

本文說明如何在 Azure Machine Learning 設計工具（預覽）中使用 [交叉驗證模型] 模組。 *交叉驗證*是一種技術，通常用於機器學習服務，以評估資料集的變化，以及透過該資料定型之任何模型的可靠性。  

[交叉驗證模型] 模組會將加上標籤的資料集作為輸入，以及未定型的分類或回歸模型。 它會將資料集分割成數個子集（折*迭）、* 在每個折迭上建立模型，然後傳回每個折迭的一組精確度統計資料。 藉由比較所有折迭的精確度統計資料，您可以解讀資料集的品質。 接著，您可以瞭解模型是否容易受到資料中的變化。  

[交叉驗證模型] 也會傳回資料集的預測結果和機率，讓您能夠評估預測的可靠性。  

### <a name="how-cross-validation-works"></a>交叉驗證的運作方式

1. 交叉驗證會隨機將定型資料分成折迭。 

   如果您先前未分割資料集，演算法的預設值為 10 個摺疊。 若要將資料集分割成不同的折迭數，您可以使用[分割區和範例](partition-and-sample.md)模組，並指定要使用多少折迭。  

2.  模組會將 [折迭 1] 中的資料設定為用於驗證。 （這有時稱為「*維持折*迭」）。此模組會使用其餘的折迭來定型模型。 

    例如，如果您建立五個折迭，此模組會在交叉驗證期間產生五個模型。 此模組會使用四個欄五分之二的資料來訓練每個模型。 它會在剩餘的一個-第五個上測試每個模型。  

3.  測試每個折迭的模型期間，模組會評估多個精確度統計資料。 模組所使用的統計資料取決於您所評估的模型類型。 不同的統計資料可用來評估分類模型與回歸模型。  

4.  當所有折迭的建築物和評估程式完成時，交叉驗證模型會針對所有資料產生一組效能度量和計分結果。 請檢查這些計量，以查看是否有任何單一折迭具有高或低準確度。 

### <a name="advantages-of-cross-validation"></a>交叉驗證的優點

評估模型的另一個常見方式是使用[分割資料](split-data.md)，將資料分割成定型集和測試集，然後在定型資料上驗證模型。 但是交叉驗證提供一些優點：  

-   交叉驗證會使用更多的測試資料。

    交叉驗證會使用較大的資料空間中的指定參數來測量模型的效能。 也就是說，交叉驗證會使用整個訓練資料集來進行定型和評估，而不是部分。 相反地，如果您使用從隨機分割產生的資料來驗證模型，通常您只會在30% 或較少的可用資料上評估模型。  

    不過，由於交叉驗證會在較大型的資料集上多次定型和驗證模型，因此需要大量的計算。 這比在隨機分割上進行驗證所花的時間更長。  

-   交叉驗證會評估資料集和模型。

    交叉驗證不會只測量模型的精確度。 此外，它也會讓您瞭解資料集的代表方式，以及模型可能對資料變化的區分程度。  

## <a name="how-to-use-cross-validate-model"></a>如何使用交叉驗證模型

如果您的資料集很大，交叉驗證可能需要很長的時間才能執行。  因此，在建立和測試模型的初始階段中，您可以使用 [交叉驗證模型]。 在該階段中，您可以評估模型參數的健全度（假設計算時間是可容忍的）。 接著，您可以使用已建立的參數搭配[定型模型](train-model.md)和[評估模型](evaluate-model.md)模組來定型和評估模型。

在此案例中，您可以使用 [交叉驗證模型] 來定型和測試模型。

1. 將 [交叉驗證模型] 模組新增至您的管線。 您可以在 Azure Machine Learning 設計工具的**模型評分 & 評估**類別目錄中找到它。 

2. 連接任何分類或回歸模型的輸出。 

    例如，如果您使用**兩個類別貝氏機率分類點機器**進行分類，請使用您想要的參數來設定模型。 然後，將連接器從分類器的未定型**模型**埠拖曳至交叉驗證模型的相符通訊埠。 

    > [!TIP] 
    > 您不需要定型模型，因為交叉驗證模型會在評估過程中自動訓練模型。  
3.  在交叉驗證模型的**資料集**埠上，連接任何加上標籤的訓練資料集。  

4.  在 [交叉驗證模型] 的 [**屬性**] 窗格中，選取 [**啟動資料行選取器**]。 選擇包含類別標籤或可預測值的單一資料行。 

5. 如果您想要在相同資料的連續執行之間重複交叉驗證的結果，請設定 [**隨機種子**] 參數的值。  

6. 執行管道。

7. 如需報告的描述，請參閱[結果](#results)一節。

    若要取得模型的複本以供稍後重複使用，請以滑鼠右鍵按一下包含演算法之模組的輸出（例如，**這兩個類別的貝氏機率分類點機器**）。 然後選取 [**另存為定型模型**]。

## <a name="results"></a>結果

所有的反復專案都完成之後，[交叉驗證模型] 會為整個資料集建立分數。 它也會建立可用來評估模型品質的效能度量。

### <a name="scored-results"></a>計分的結果

模組的第一個輸出會提供每個資料列的來源資料，以及一些預測的值和相關的機率。 

若要查看這些結果，請在管線中，以滑鼠右鍵按一下 [交叉驗證模型] 模組。 選取 [**計分的結果**]，然後選取 [**視覺化**]。

| 新資料行名稱      | 說明                              |
| -------------------- | ---------------------------------------- |
| 評分標籤        | 這個資料行會加入至資料集的結尾。 它包含每個資料列的預測值。 |
| 計分機率 | 這個資料行會加入至資料集的結尾。 它會指出**評分標籤**中值的預估機率。 |
| 折迭編號          | 表示在交叉驗證期間指派給每個資料列之折迭的以零為起始的索引。 |

 ### <a name="evaluation-results"></a>Evaluation results

第二個報表是依折迭分組。 請記住，在執行期間，交叉驗證模型會隨機將定型資料分割成*n*折迭（預設為10）。 在資料集的每個反復專案中，交叉驗證模型會使用一個折迭做為驗證資料集。 它會使用其餘的*n-1*折迭來定型模型。 每個模型都會針對所有其他折迭*中的資料*進行測試。

在此報表中，折迭依索引值以遞增順序列出。  若要在其他任何資料行上排序，您可以將結果儲存為 dataset。

若要查看這些結果，請在管線中，以滑鼠右鍵按一下 [交叉驗證模型] 模組。 選取 [**評估結果（依折**迭）]，然後選取 [**視覺化**]。


|資料行名稱| 說明|
|----|----|
|折迭編號| 每個折迭的識別碼。 如果您建立了五個折迭，則會有五個數據子集，編號為0到4。
|折迭中的範例數目|指派給每個折迭的資料列數目。 它們應該大致相等。 |


此模組也會針對每個折迭包含下列計量，視您要評估的模型類型而定： 

+ **分類模型**：精確度、召回率、F 分數、AUC、精確度  

+ **回歸模型**：平均絕對錯誤、根平均平方誤差、相對絕對錯誤、相對平方誤差和判斷係數


## <a name="technical-notes"></a>技術說明  

+ 最佳做法是先將資料集正規化，再使用它們來進行交叉驗證。 

+ 交叉驗證模型比較密集，而且需要較長的時間來完成，而不是使用隨機分割的資料集來驗證模型。 這是因為交叉驗證模型會多次定型和驗證模型。

+ 當您使用交叉驗證來測量模型的精確度時，不需要將資料集分割成定型集和測試集。 


## <a name="next-steps"></a>後續步驟

請參閱可用來 Azure Machine Learning 的[模組集合](module-reference.md)。 

