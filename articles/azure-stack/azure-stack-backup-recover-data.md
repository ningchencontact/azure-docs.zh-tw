---
title: 在 Azure Stack 中使用基礎結構備份服務，從重大資料遺失的情況下復原 | Microsoft Docs
description: 發生重大錯誤而導致 Azure Stack 失敗時，您可以在重新建立 Azure Stack 部署時還原基礎結構資料。
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: 2ECE8580-0BDE-4D4A-9120-1F6771F2E815
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2018
ms.author: jeffgilb
ms.reviewer: hectorl
ms.openlocfilehash: ed89468d65f35d0a8cda90da365e8625f46e3f92
ms.sourcegitcommit: 387d7edd387a478db181ca639db8a8e43d0d75f7
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/10/2018
ms.locfileid: "41954621"
---
# <a name="recover-from-catastrophic-data-loss"></a>從重大資料遺失的情況下復原

適用於：Azure Stack 整合系統。

Azure Stack 會在您的資料中心內執行 Azure 服務。 Azure Stack 執行所在的環境，可以小到像是單一機架上所安裝的四個節點。 反之，Azure 則會在超過 40 個區域的多個資料中心內執行，每個區域內還有多個地區。 使用者資源可能會跨越多部伺服器、機架、資料中心和區域。 若使用 Azure Stack，您目前只能選擇將整個雲端部署到單一機架上。 這會讓您的雲端曝露在資料中心發生重大事件，或因為重大產品錯誤而失敗的風險下。 發生災害事件時，Azure Stack 執行個體將會離線。 所有資料都可能無法復原。

視資料遺失的根本原因而定，您可能會需要修復單一基礎結構服務，或還原整個 Azure Stack 執行個體。 您甚至可能需要在相同的位置或不同的位置，還原到不同的硬體上。

本案例說明如何在設備失敗時復原整個安裝，以及如何重新部署私人雲端。

| 案例                                                           | 資料遺失                            | 考量                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| 從災害或產品錯誤所導致的重大資料遺失情況下復原 | 所有的基礎結構、使用者和應用程式資料 | 使用者應用程式和資料在基礎結構資料中會分別受到保護 |

## <a name="workflows"></a>工作流程

保護 Azure Start 的工作，從分別備份基礎結構和應用程式/租用戶資料開始。 本文件涵蓋如何保護基礎結構。 

![Azure Stack 的初始部署](media\azure-stack-backup\azure-stack-backup-workflow1.png)

在遺失所有資料的最糟情況下，要復原 Azure Stack 需要還原該 Azure Stack 部署所獨有的基礎結構資料和所有使用者資料。 

![重新部署 Azure Stack](media\azure-stack-backup\azure-stack-backup-workflow2.png)

## <a name="restore"></a>Restore

若發生重大資料遺失但硬體仍可使用，則需要重新部署 Azure Stack。 在重新部署期間，您可以指定儲存位置及存取備份所需的認證。 在此模式下，無須指定需要還原的服務。 基礎結構備份控制器會插入控制平面狀態，作為部署工作流程的一部分。

若災害導致硬體無法使用，就只能在新硬體上進行重新部署。 因為要訂購替換的硬體並等待其到達資料中心，重新部署可能需要數週的時間。 但還原控制平面資料隨時都可以進行。 不過，若重新部署的執行個體版本，比最後一個備份所使用的版本高出超過一個版本，就不支援還原。 

| 部署模式 | 起點 | 終點                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 全新安裝   | 基準組建 | OEM 會部署 Azure Stack，並更新為支援的最新版本。                                                                                                                                          |
| 復原模式   | 基準組建 | OEM 會在復原模式下部署 Azure Stack，並根據可用的最新備份來處理版本比對需求。 OEM 會將其更新為支援的最新版本，以完成部署。 |

## <a name="data-in-backups"></a>在備份中的資料

Azure Stack 支援一種稱為「雲端復原模式」的部署。 只有在災害或產品錯誤導致解決方案無法復原後，您選擇復原 Azure Stack 時，才會使用此模式。 這種部署模式不會復原任何儲存在解決方案中的使用者資料。 這種部署模式的範圍僅限於還原下列資料：

 - 部署輸入
 - 內部身分識別系統
 - 同盟身分識別設定 (已中斷連線的部署)
 - 內部憑證授權單位所使用的根憑證
 - Azure Resource Manager 設定使用者資料，例如訂用帳戶、方案、供應項目，以及儲存體、網路和計算資源的配額
 - KeyVault 祕密和保存庫
 - RBAC 原則指派和角色指派 

在部署期間不會復原任何使用者的基礎結構即服務 (IaaS) 或平台即服務 (PaaS) 資源。 也就是說，包括 IaaS VM、儲存體帳戶、BLOb、資料表、網路設定等等都會遺失。 雲端復原的目的在於確保您的操作員和使用者在部署完成後，可以重新登入入口網站。 重新登入的使用者不會看到任何資源。 系統會還原使用者的訂用帳戶，以及系統管理員所定義的原始方案和供應項目原則。 重新登入系統的使用者在操作時，同樣會受到災害發生前原始解決方案所設下限制的約束。 雲端復原完成後，操作員可以手動還原加值和第三方 RP 及相關聯的資料。

## <a name="next-steps"></a>後續步驟

 - 了解[使用基礎結構的備份服務](azure-stack-backup-best-practices.md)的最佳做法。
