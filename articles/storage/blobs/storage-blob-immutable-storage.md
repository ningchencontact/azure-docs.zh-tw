---
title: 不可變的 blob 儲存體-Azure 儲存體
description: Azure 儲存體為 Blob 物件儲存體提供 WORM (一次寫入，多次讀取) 支援，可讓使用者在指定的間隔內以不可清除、不可修改的狀態儲存資料。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 11/18/2019
ms.author: tamram
ms.reviewer: hux
ms.subservice: blobs
ms.openlocfilehash: 473f1d12188a8686748d19c8c35d4421f9477ae9
ms.sourcegitcommit: e9776e6574c0819296f28b43c9647aa749d1f5a6
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/13/2020
ms.locfileid: "75912804"
---
# <a name="store-business-critical-blob-data-with-immutable-storage"></a>使用不可變的儲存體儲存業務關鍵的 blob 資料

Azure Blob 儲存體的固定儲存體可讓使用者以 WORM （一次寫入，多次讀取）狀態儲存業務關鍵資料物件。 此狀態讓資料在使用者指定的間隔內不可清除，也不可修改。 在保留間隔的持續期間內，可以建立和讀取 blob，但無法修改或刪除。 固定儲存體適用于所有 Azure 區域中的一般用途 v1、一般用途 v2、BlobStorage 和 BlockBlobStorage 帳戶。

如需如何使用 Azure 入口網站、PowerShell 或 Azure CLI 來設定和清除合法保存或建立以時間為基礎的保留原則的詳細資訊，請參閱[設定和管理 Blob 儲存體的不可變性原則](storage-blob-immutability-policies-manage.md)。

## <a name="about-immutable-blob-storage"></a>關於不可變的 Blob 儲存體

固定存放裝置可協助醫療保健組織、金融機構和相關產業&mdash;特別是經紀商組織&mdash;能夠安全地儲存資料。 在任何情況下，也可以利用固定儲存體來保護重要資料，以防止修改或刪除。

典型應用包括：

- **法規遵循**：Azure Blob 儲存體的固定儲存體可協助組織處理 SEC 17a-4(f)、CFTC 1.31(d)、FINRA 和其他法規。 技術白皮書 Cohasset 將詳細說明如何透過[Microsoft 服務信任入口網站](https://aka.ms/AzureWormStorage)，下載不可變的儲存體如何解決這些法規需求。 [Azure 信任中心](https://www.microsoft.com/trustcenter/compliance/compliance-overview)包含有關我們的合規性認證的詳細資訊。

- **安全檔保留**： Azure Blob 儲存體的固定儲存體可確保任何使用者都無法修改或刪除資料，包括具有帳戶系統管理許可權的使用者。

- **合法保存**： Azure Blob 儲存體的固定儲存體可讓使用者在所需的持續期間內，儲存對訴訟或業務使用很重要的機密資訊，直到移除保存為止。 這項功能不只限於合法使用案例，也可以視為以事件為基礎的保存或企業鎖定，需要根據事件觸發程式或公司原則來保護資料的需求。

不可變的儲存體支援下列功能：

- 以 **[時間為基礎的保留原則支援](#time-based-retention-policies)** ：使用者可以設定原則，以在指定的間隔內儲存資料。 設定以時間為基礎的保留原則時，可以建立和讀取 blob，但不能修改或刪除。 保留期限到期後，可以刪除 blob，但不會覆寫。

- **[合法保存原則支援](#legal-holds)** ：如果不知道保留間隔，使用者可以設定合法保存來儲存不可變的資料，直到清除合法保存為止。  設定合法保存原則時，可以建立和讀取 blob，但不能修改或刪除。 每個合法保存都會與使用者定義的英數位元標記相關聯（例如案例識別碼、事件名稱等），做為識別碼字串。 

- **所有 Blob 層都支援：** WORM 原則與 Azure Blob 儲存層無關，而且會套用至所有層：經常性存取層、非經常性存取層和封存存取層。 使用者可以將資料轉換到其工作負載的成本最佳化層中，同時維護資料不變性。

- **容器層級組態**：使用者可以在容器層級設定以時間為基礎的保留原則和合法保存標記。 使用簡單的容器層級設定，使用者可以建立及鎖定以時間為基礎的保留原則、延長保留間隔、設定和清除法務保存等等。 這些原則會套用到現有和新容器中的所有 Blob。

- **審核記錄支援**：每個容器都包含一個原則 Audit 記錄檔。 它會針對鎖定的以時間為基礎的保留原則，最多顯示7個以時間為基礎的保留命令，並包含使用者識別碼、命令類型、時間戳記及保留間隔。 針對合法保存，此記錄包含使用者識別碼、命令類型、時間戳記及合法保存標記。 此記錄會保留在原則的存留期間，符合 SEC 17a-4 （f）法規指導方針。 [ [Azure 活動記錄](../../azure-monitor/platform/platform-logs-overview.md)檔] 會顯示所有控制平面活動的更完整記錄;啟用[Azure 診斷記錄](../../azure-monitor/platform/platform-logs-overview.md)時，會保留並顯示資料平面作業。 基於法規需求或其他目的，使用者有責任持續不斷地儲存那些記錄。

## <a name="how-it-works"></a>運作方式

Azure Blob 儲存體的固定儲存體支援兩種 WORM 或固定原則：以時間為基礎的保留和合法保存。 在容器上套用以時間為基礎的保留原則或合法保存時，所有現有的 blob 都會在30秒內移至不可變的 WORM 狀態。 所有上傳至該受原則保護容器的新 blob 也會移至不可變的狀態。 當所有 blob 都處於不可變的狀態之後，就會確認不可變的原則，而且不允許不可變容器中的任何覆寫或刪除作業。

如果容器中有任何 blob 受到合法保存或鎖定的以時間為基礎的原則保護，也不允許刪除容器和儲存體帳戶。 合法保存原則會防止 blob、容器和儲存體帳戶刪除。 已解除鎖定和鎖定時間型原則都會在指定的時間，防止 blob 刪除。 只有在容器內至少有一個 blob 時，已解除鎖定和鎖定的時間型原則才會保護容器的刪除。 只有*鎖定*以時間為基礎之原則的容器，才能防止儲存體帳戶遭到刪除;已解除鎖定以時間為基礎之原則的容器不會提供儲存體帳戶刪除保護或合規性。

如需有關如何設定和鎖定以時間為基礎之保留原則的詳細資訊，請參閱[設定和管理 Blob 儲存體的不可變性原則](storage-blob-immutability-policies-manage.md)。

## <a name="time-based-retention-policies"></a>以時間為基礎的保留原則

> [!IMPORTANT]
> 必須*鎖定*以時間為基礎的保留原則，blob 才會符合 SEC 17a-4 （f）和其他法規合規性的不變（寫入和刪除保護）狀態。 我們建議您在合理的時間內鎖定原則，通常不到24小時。 套用的以時間為基礎的保留原則初始狀態已*解除鎖定*，可讓您測試功能並對原則進行變更，然後再加以鎖定。 雖然 [已*解除鎖定*] 狀態提供非永久性保護，但不建議針對短期功能試用以外的任何目的使用 [*解除鎖定*] 狀態。 

若在容器上套用以時間為基礎的保留原則，在「有效」保留期限內，容器中的所有 Blob 都會保持固定狀態。 Blob 的有效保留期限等於 blob 的**建立時間**與使用者指定的保留間隔之間的差異。 因為使用者可以延長保留間隔，所以固定儲存體會使用使用者所指定保留間隔的最新值，計算有效的保留期限。

例如，假設使用者建立以時間為基礎的保留原則，其保留間隔為五年。 該容器中的現有 blob （ _testblob1)_ ）是一年前建立的;因此， _testblob1)_ 的有效保留期限為四年。 將新的 blob （ _testblob2_）上傳至容器時， _testblob2_的有效保留期限是從其建立時間起的五年。

建議僅針對功能測試使用已解除鎖定的以時間為基礎的保留原則，而且必須鎖定原則，才能符合 SEC 17a-4 （f）和其他法規合規性。 鎖定以時間為基礎的保留原則之後，就無法移除原則，且允許的有效保留期限上限為五個。

下列限制適用于保留原則：

- 針對儲存體帳戶，具有鎖定之以時間為基礎的不可變原則的容器數目上限為10000。
- 最小保留間隔是一天。 最大值為146000天（400年）。
- 針對容器，針對鎖定的以時間為基礎的不可變原則，擴充保留間隔的編輯次數上限為5。
- 針對容器，已鎖定的原則會保留最多七個以時間為基礎的保留原則 audit 記錄。

### <a name="allow-protected-append-blobs-writes"></a>允許受保護的附加 blob 寫入

附加 blob 是由資料區塊所組成，並已針對審核和記錄案例所需的資料附加作業優化。 根據設計，附加 blob 只允許將新區塊新增至 blob 結尾。 不論是否有任何不受的改變，都不允許在附加 blob 中修改或刪除現有區塊。 若要深入瞭解附加 blob，請參閱[關於附加 blob](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-append-blobs)。

只有以時間為基礎的保留原則具有 `allowProtectedAppendWrites` 設定，可讓您將新的區塊寫入至附加 blob，同時維持不安全的保護和合規性。 啟用時，您可以直接在受原則保護的容器中建立附加 blob，並繼續使用*AppendBlock* API，將新的資料區塊新增至現有附加 blob 的結尾。 只能新增新的區塊，而且無法修改或刪除任何現有的區塊。 時間保留不存在的保護仍然適用，防止刪除附加 blob，直到經過有效的保留期限為止。  

由於此設定是以時間為基礎的保留原則的一部分，因此附加 blob 在*有效*保留期間的持續時間內仍會保持不變狀態。 由於新的資料可以附加在初始建立附加 blob 之外，因此決定保留週期的方式會有些許差異。 [有效保留] 是 [附加 blob 的**上次修改時間**] 和 [使用者指定的保留間隔] 之間的差異。 同樣地，當保留間隔擴充時，固定儲存體會使用使用者指定的保留間隔的最新值來計算有效的保留期限。

例如，假設使用者建立以時間為基礎的保留原則，並啟用 `allowProtectedAppendWrites`，保留間隔為90天。 現在會在容器中建立附加 blob _logblob1_，而新的記錄會繼續在接下來的10天內新增至附加 blob;因此， _logblob1_的有效保留期限是從今天起算的100天（最後一個附加的時間 + 90 天）。

解除鎖定以時間為基礎的保留原則可讓 `allowProtectedAppendWrites` 設定隨時啟用和停用。 一旦鎖定以時間為基礎的保留原則，就無法變更 `allowProtectedAppendWrites` 設定。

合法保存原則無法啟用 `allowProtectedAppendWrites`，且不允許將新的區塊附加至附加 blob。 如果將合法保存套用至已啟用 `allowProtectedAppendWrites` 的以時間為基礎的保留原則，則*AppendBlock* API 將會失敗，直到您放棄合法保存為止。

> [!IMPORTANT] 
> [以時間為基礎的保留] 下的 [允許受保護的附加 blob 寫入] 設定目前適用于下欄區域：
> - 美國東部
> - 美國中南部
> - 美國西部 2
>
> 此時，我們強烈建議您不要在指定的任何其他區域中啟用 `allowProtectedAppendWrites`，因為它可能會導致間歇性失敗，並影響附加 blob 的相容性。 如需有關如何設定和鎖定以時間為基礎之保留原則的詳細資訊，請參閱[啟用允許受保護的附加 blob 寫入](storage-blob-immutability-policies-manage.md#enabling-allow-protected-append-blobs-writes)。

## <a name="legal-holds"></a>合法保存

合法保存是暫時保留，可用於法律調查用途或一般保護原則。 每個合法保存原則都必須與一或多個標記相關聯。 標記是用來做為命名識別碼（例如案例 ID 或事件），以分類及描述保存的用途。

一個容器可以同時具有合法保存和以時間為基礎的保留原則。 該容器中的所有 Blob 都會保持固定狀態，直到所有合法保存都遭到清除為止 (即使其有效保留期限已過期)。 相反地，Blob 會保持固定狀態，直到有效保留週期到期為止 (即使已清除所有合法保存)。

下列限制適用于合法保存：

- 針對儲存體帳戶，具有合法保存設定的容器數目上限為10000。
- 若為容器，合法保存標記數目上限為 10。
- 合法保存標記的最小長度為三個英數位元。 最大長度為23個英數位元。
- 針對容器，原則期間會保留最多10個合法保存原則的 audit 記錄。

## <a name="scenarios"></a>案例
下表顯示針對不同的不可變案例停用的 Blob 儲存體作業類型。 如需詳細資訊，請參閱[Azure Blob 服務 REST API](https://docs.microsoft.com/rest/api/storageservices/blob-service-rest-api)檔。

|案例  |Blob 狀態  |已拒絕 Blob 作業  |容器和帳戶保護
|---------|---------|---------|---------|
|Blob 上的有效保留間隔尚未過期及/或已設定合法保存     |固定：防刪與防寫保護         | 放置 Blob<sup>1</sup>、放置區塊<sup>1</sup>、放置區塊清單<sup>1</sup>、刪除容器、刪除 blob、設定 Blob 中繼資料、放置分頁、設定 Blob 屬性、快照集 Blob、累加複製 Blob、附加區塊<sup>2</sup>         |容器刪除被拒;拒絕刪除儲存體帳戶         |
|Blob 上的有效保留間隔已過期，且未設定合法保存    |僅限防寫保護 (允許刪除作業)         |放置 Blob<sup>1</sup>、放置區塊<sup>1</sup>、放置區塊清單<sup>1</sup>、設定 blob 中繼資料、放置分頁、設定 Blob 屬性、快照集 Blob、增量複製 Blob、附加區塊<sup>2</sup>         |如果受保護容器中至少有1個 blob，則會拒絕容器刪除;只有*鎖定*的以時間為基礎的原則，才會拒絕刪除儲存體帳戶         |
|未套用任何 WORM 原則（沒有以時間為基礎的保留，而且沒有合法的保存標記）     |可變動         |無         |無         |

<sup>1</sup> blob 服務允許這些作業一次建立新的 blob。 不允許不可變容器中現有 blob 路徑上的所有後續覆寫作業。

<sup>2</sup>只有啟用 `allowProtectedAppendWrites` 屬性的以時間為基礎的保留原則才允許附加區塊。 如需詳細資訊，請參閱[允許受保護的附加 Blob 寫入](#allow-protected-append-blobs-writes)一節。

## <a name="pricing"></a>定價

使用這項功能不需額外付費。 固定資料的定價方式與可變數據相同。 如需 Azure Blob 儲存體的定價詳細資料，請參閱[Azure 儲存體定價頁面](https://azure.microsoft.com/pricing/details/storage/blobs/)。

## <a name="faq"></a>常見問題集

**您可以提供 WORM 合規性的檔嗎？**

可以。 為了記載合規性，Microsoft 保留了領先的獨立評估公司，專門從事記錄管理和資訊治理，Cohasset 關聯，以評估不可變的 Blob 儲存體，以及其是否符合特定的需求金融服務產業。 Cohasset 已驗證不變的 Blob 儲存體（當用來以 WORM 狀態保留以時間為基礎的 Blob）時，會符合 CFTC 規則1.31 （c）-（d）、FINRA 規則4511和 SEC 規則17a-4 的相關儲存需求。 Microsoft 以這組規則為目標，因為它們代表針對金融機構的記錄保留範圍內最具規範性的指導方針。 Cohasset 報告可在[Microsoft 服務信任中心](https://aka.ms/AzureWormStorage)取得。 若要向 Microsoft 要求關於 WORM 不符合規範的證明，請洽詢 Azure 支援。

**此功能是否只適用于區塊 blob 和附加 blob，或分頁 blob？**

不可變的儲存體可以搭配任何 blob 類型使用，因為它是在容器層級設定的，但我們建議您針對主要儲存區塊 blob 和附加 blob 的容器使用 WORM。 容器中的現有 blob 會受到新設定的 WORM 原則保護。 但所有的新分頁 blob 都必須在 WORM 容器外部建立，然後再複製到中。 複製到 WORM 容器後，不允許進一步變更分頁 blob。 不建議您在儲存任何使用中虛擬機器之 Vhd （分頁 blob）的容器上設定 WORM 原則，因為它會鎖定 VM 磁片。 我們建議您在鎖定任何以時間為基礎的原則之前，徹底檢查檔並測試您的案例。

**我是否需要建立新的儲存體帳戶才能使用這項功能？**

否，您可以搭配任何現有或新建立的一般用途 v1、一般用途 v2、BlobStorage 或 BlockBlobStorage 帳戶來使用不可變的儲存體。 支援一般用途 v1 儲存體帳戶，但我們建議您升級至一般用途 v2，讓您可以利用更多的功能。 如需升級現有一般用途 v1 儲存體帳戶的相關資訊，請參閱[升級儲存體帳戶](../common/storage-account-upgrade.md)。

**我可以同時套用合法保存和以時間為基礎的保留原則嗎？**

是，容器可以同時具有合法保存和以時間為基礎的保留原則。 該容器中的所有 Blob 都會保持固定狀態，直到所有合法保存都遭到清除為止 (即使其有效保留期限已過期)。 相反地，Blob 會保持固定狀態，直到有效保留週期到期為止 (即使已清除所有合法保存)。

**合法的持有原則是否僅適用于法律訴訟，或是否有其他使用案例？**

否，合法保存只是用於非以時間為基礎之保留原則的一般詞彙。 它不需要僅用於訴訟相關的訴訟。 合法保存原則適用于停用覆寫和刪除，以保護重要的企業蠕蟲資料，其中保留期限不明。 在自訂事件觸發程式需要使用以時間為基礎的保留原則之前，您可以使用它做為企業原則來保護您的任務關鍵性 WORM 工作負載，或使用它做為預備原則。 

**我可以移除_鎖定_的以時間為基礎的保留原則或合法保存嗎？**

只能從容器中移除解除鎖定的以時間為基礎的保留原則。 一旦鎖定以時間為基礎的保留原則，就無法將它移除;僅允許有效的保留週期延伸。 您可以刪除合法的標記。 刪除所有合法標記時，將會移除合法的保存。

**如果我嘗試刪除具有以時間為基礎的保留原則或合法保存的容器，會發生什麼事？**

如果容器內至少有一個 blob 具有鎖定或解除鎖定的以時間為基礎的保留原則，或容器具有合法保存，則刪除容器作業將會失敗。 只有當容器中沒有任何 blob 存在，而且沒有合法的保存時，刪除容器作業才會成功。 

**如果我嘗試刪除具有以時間為基礎的保留原則或合法保存之容器的儲存體帳戶，會發生什麼事？**

如果至少有一個容器具有合法保存集或**鎖定**的以時間為基礎的原則，則儲存體帳戶刪除作業將會失敗。 具有已解除鎖定之以時間為基礎之原則的容器無法防止刪除儲存體帳戶。 您必須先移除所有合法保存並刪除所有**鎖定**的容器，才能刪除儲存體帳戶。 如需有關容器刪除的資訊，請參閱前面的問題。 您也可以對具有[Azure Resource Manager 鎖定](../../azure-resource-manager/resource-group-lock-resources.md)的儲存體帳戶套用進一步的刪除保護。

**當 blob 處於不可變狀態時，可以將資料移到不同的 blob 層（經常性存取、非經常性存取、封存）嗎？**

是，您可以使用 [設定 Blob 層] 命令跨 Blob 層移動資料，同時將資料保持在符合規範的固定狀態。 Blob 經常性存取層、非經常性存取層和封存存取層都支援固定儲存體。

**如果我付款失敗，而保留間隔尚未過期，則會發生什麼事？**

如果未付款，則會依照您與 Microsoft 簽訂的合約條款與條件規定，套用一般資料保留原則。

**您是否提供試用此功能的試用版或寬限期？**

可以。 第一次建立以時間為基礎的保留原則時，它會處於「未*鎖定*」狀態。 在此狀態中，您可以對保留間隔進行任何所需的變更，例如增加或減少保留間隔，甚至刪除原則。 鎖定原則之後，會保持鎖定狀態，直到保留間隔到期為止。 這個鎖定的原則會防止刪除和修改保留間隔。 我們強烈建議僅將「未鎖定」狀態使用於試用目的，並且在 24 小時期間內鎖定原則。 這些做法可協助您符合 SEC 17a-4(f) 和其他法規。

**我可以搭配不可變的 blob 原則使用虛刪除嗎？**

是，如果您的合規性需求允許啟用虛刪除。 [Azure Blob 儲存體](storage-blob-soft-delete.md)的虛刪除會套用至儲存體帳戶內的所有容器，而不論是合法保存或以時間為基礎的保留原則。 建議您先啟用虛刪除以提供額外的保護，再套用和確認任何不可變的 WORM 原則。

## <a name="next-steps"></a>後續步驟

- [設定和管理 Blob 儲存體的不可變性原則](storage-blob-immutability-policies-manage.md)
- [使用生命週期管理將規則設定為自動分層和刪除 blob 資料](storage-lifecycle-management-concepts.md)
- [Azure 儲存體 Blob 的虛刪除](../blobs/storage-blob-soft-delete.md)
- [使用 Azure Resource Manager 鎖定來保護訂用帳戶、資源群組和資源](../../azure-resource-manager/resource-group-lock-resources.md)。
