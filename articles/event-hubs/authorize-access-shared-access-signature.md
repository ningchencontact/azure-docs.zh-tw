---
title: 使用 Azure 事件中樞中的共用存取簽章來授權存取
description: 本文提供的資訊說明如何使用共用存取簽章 (SAS) 來授權 Azure 事件中樞資源的存取權。
services: event-hubs
ms.service: event-hubs
documentationcenter: ''
author: spelluru
ms.topic: conceptual
ms.date: 08/22/2019
ms.author: spelluru
ms.openlocfilehash: bdb1896f8a40c6de21ae76b536bfccec316341cd
ms.sourcegitcommit: 007ee4ac1c64810632754d9db2277663a138f9c4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/23/2019
ms.locfileid: "69992792"
---
# <a name="authorizing-access-to-event-hubs-resources-using-shared-access-signatures"></a>使用共用存取簽章授權事件中樞資源的存取權
共用存取簽章 (SAS) 可讓您將有限的存取權授與事件中樞命名空間中的資源。 SAS 會根據授權規則來保護事件中樞資源的存取權。 這些規則是在命名空間或實體 (事件中樞或主題) 上設定。 本文提供 SAS 模型的總覽, 並回顧 SAS 最佳做法。

## <a name="what-are-shared-access-signatures"></a>什麼是共用存取簽章？
共用存取簽章 (SAS) 會根據授權規則提供事件中樞資源的委派存取權。 授權規則具有名稱、與特定權限相關聯，並且承載了密碼編譯金鑰組。 您可以透過事件中樞用戶端或您自己的程式碼, 使用規則的名稱和金鑰來產生 SAS 權杖。 然後, 用戶端就可以將權杖傳遞給事件中樞, 以證明所要求作業的授權。

SAS 是使用簡單權杖以宣告為基礎的授權機制。 使用 SAS 時，金鑰一律不會透過網路傳遞。 金鑰可用來以密碼編譯方式簽署稍後可由服務驗證的資訊。 SAS 的作用可類似於用戶端直接擁有授權規則名稱和相符金鑰的使用者名稱和密碼。 SAS 可以類似于同盟安全性模型, 其中用戶端會從 Security Token Service 收到有時間限制且已簽署的存取權杖, 而不會有任何人擁有簽署金鑰。

> [!NOTE]
> Azure 事件中樞支援使用 Azure Active Directory (Azure AD) 來授權事件中樞資源。 使用 Azure AD 所傳回的 OAuth 2.0 權杖來授權使用者或應用程式, 可透過共用存取簽章 (SAS) 提供優異的安全性和易用性。 有了 Azure AD, 就不需要在程式碼中儲存權杖, 也可能會有潛在的安全性弱點。
>
> Microsoft 建議您盡可能使用 Azure AD 與您的 Azure 事件中樞應用程式。 如需詳細資訊, 請參閱[使用 Azure Active Directory 授權 Azure 事件中樞資源的存取權](authorize-access-azure-active-directory.md)。

> [!IMPORTANT]
> SAS (共用存取簽章) 權杖對於保護您的資源很重要。 提供細微性時, SAS 會授與用戶端事件中樞資源的存取權。 這些不應公開共用。 共用時, 如果需要疑難排解的原因, 請考慮使用任何記錄檔的精簡版本, 或從記錄檔中刪除 SAS 權杖 (如果有的話), 並確定螢幕擷取畫面不會包含 SAS 資訊。

## <a name="shared-access-authorization-policies"></a>共用存取授權原則
每個事件中樞命名空間和每個事件中樞實體 (事件中樞實例或 Kafka 主題) 都具有由規則組成的共用存取授權原則。 命名空間層級的原則會套用至命名空間內的所有實體，無論其個別的原則組態為何。
針對每個授權原則規則, 您會決定三項資訊: 名稱、範圍和許可權。 名稱是該範圍內的唯一名稱。 範圍是有問題之資源的 URI。 針對事件中樞命名空間, 範圍是完整功能變數名稱 (FQDN), 例如`https://<yournamespace>.servicebus.windows.net/`。

原則規則所提供的許可權可以是下列各項的組合:
- **Send** –提供將訊息傳送至實體的許可權
- **接聽**–提供接聽或接收實體的權利
- **管理**–提供管理命名空間拓撲的許可權, 包括建立和刪除實體

> [!NOTE]
> [**管理**] 許可權包括 [**傳送**] 和 [**接聽**] 許可權。

命名空間或實體原則最多可以保留12個共用存取授權規則, 為三組規則提供空間, 其中每個規則都涵蓋基本許可權, 以及傳送和接聽的組合。 此限制表示 SAS 原則存放區不適合作為使用者或服務帳戶存放區。 如果您的應用程式需要根據使用者或服務身分識別來授與事件中樞資源的存取權, 就應該在驗證和存取檢查之後, 執行會發出 SAS 權杖的 Security Token Service。

授權規則會指派一個**主要金鑰**和**次要金鑰**。 這些金鑰是密碼編譯的強式金鑰。 不要遺失或洩漏它們。 它們一律會在 Azure 入口網站中提供。 您可以使用其中一個產生的金鑰，以及您可以隨時重新產生它們。 如果您重新產生或變更原則中的金鑰，所有先前根據該金鑰發行的權杖都將立即無效。 不過，根據這類權杖建立的作用中連線會繼續運作，直到權杖到期。

當您建立事件中樞命名空間時, 系統會自動為命名空間建立名為**RootManageSharedAccessKey**的原則規則。 此原則具有整個命名空間的 [**管理**] 許可權。 建議您將此規則視為系統管理根帳號, 而不要在您的應用程式中使用它。 您可以在入口網站中的命名空間的 [**設定**] 索引標籤中, 透過 PowerShell 或 Azure CLI 建立額外的原則規則。

## <a name="best-practices-when-using-sas"></a>使用 SAS 時的最佳做法
當您在應用程式中使用共用存取簽章時，您必須留意兩個潛在風險：

- 如果 SAS 已流失, 取得它的任何人都可以使用它, 這可能會危害您的事件中樞資源。
- 如果提供給用戶端應用程式的 SAS 到期, 且應用程式無法從您的服務取得新的 SAS, 則可能會妨礙運作應用程式的功能。

下列關於使用共用存取簽章的建議，將可協助您平衡這些風險：

- **讓用戶端視需要自動更新 SAS**:用戶端應該在到期前更新 SAS, 以便在提供 SAS 的服務無法使用時, 允許重試的時間。 如果您的 SAS 是要用於需要在到期期間內完成的少數即時、短期作業, 則可能不必要, 因為 SAS 不會更新。」 不過，如果您有定期透過 SAS 做出要求的用戶端，則到期的可能性便有可能發生。 主要考慮是要平衡 SAS 存留期 (如先前所述) 的需求, 並確保用戶端以較早的速度要求更新, 以避免在更新成功之前, 因 SAS 過期而中斷的情況。
- **請小心使用 SAS 開始時間**:如果您將 SAS 的開始時間設為 [**現在**], 則由於時鐘誤差 (根據不同機器的目前時間差異), 因此可能會在前幾分鐘間歇觀察到失敗。 一般而言，請將開始時間設為至少 15 分鐘之前的時間。 或者, 完全不要設定它, 這會使它在所有情況下立即生效。 相同的一般也適用于到期時間。 請記住, 您可能會觀察到任何要求的任一方向最多15分鐘的時鐘誤差。 
- **請特別針對要存取的資源**:最佳安全性作法是為使用者提供最低必要許可權。 如果使用者只需要單一實體的讀取存取權，則授與他們該單一實體的讀取存取權，而非授與他們所有實體的讀取/寫入/刪除存取權。 它也有助於減少 SAS 遭到入侵的損害, 因為 SAS 在攻擊者手中的能力較少。
- **不一定要使用 SAS**:有時候與特定作業相關聯的風險, 對您的事件中樞而言, 會超過 SAS 的優勢。 針對這類作業, 建立仲介層服務, 在商務規則驗證、驗證和審核之後, 將其寫入您的事件中樞。
- **一律使用 HTTPs**:請一律使用 Https 來建立或散發 SAS。 如果透過 HTTP 傳遞 SAS 並攔截, 執行中間人連接的攻擊者就能夠讀取 SAS, 然後使用它, 就像預期的使用者一樣, 可能會危害敏感性資料或允許惡意使用者損毀資料。

## <a name="conclusion"></a>結論
共用存取簽章適用于提供有限的許可權給用戶端的事件中樞資源。 這些是使用 Azure 事件中樞之任何應用程式安全性模型的重要部分。 如果您遵循本文中所列的最佳做法, 您可以使用 SAS 來提供更大的資源存取彈性, 而不會危及應用程式的安全性。

## <a name="next-steps"></a>後續步驟
請參閱下列相關文章: 

- [使用 Azure Active Directory 驗證從應用程式 Azure 事件中樞的要求](authenticate-application.md)
- [使用 Azure Active Directory 來驗證受控識別, 以存取事件中樞資源](authenticate-managed-identity.md)
- [使用共用存取簽章驗證 Azure 事件中樞的要求](authenticate-shared-access-signature.md)
- [使用 Azure Active Directory 授權事件中樞資源的存取權](authorize-access-azure-active-directory.md)


