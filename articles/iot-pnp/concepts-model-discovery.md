---
title: 執行 IoT 隨插即用預覽模型探索 |Microsoft Docs
description: 身為解決方案開發人員, 瞭解如何在您的解決方案中執行 IoT 隨插即用模型探索。
author: ChrisGMsft
ms.author: chrisgre
ms.date: 07/17/2019
ms.topic: conceptual
ms.custom: mvc
ms.service: iot-pnp
services: iot-pnp
manager: philmea
ms.openlocfilehash: e4ab1d45e27762ef05ab7ec74c98ab0b0b934cbf
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2019
ms.locfileid: "69880549"
---
# <a name="implement-iot-plug-and-play-preview-model-discovery-in-an-iot-solution"></a>在 IoT 解決方案中執行 IoT 隨插即用預覽模型探索

本文說明如何以解決方案開發人員的身分, 在 IoT 解決方案中執行 IoT 隨插即用預覽模型探索。  Iot 隨插即用模型探索是 IoT 隨插即用裝置如何識別其支援的功能模型和介面, 以及 IoT 解決方案如何抓取這些功能模型和介面。

IoT 解決方案有兩種廣泛的類別: 專門建立的解決方案, 可與一組已知的 IoT 隨插即用裝置搭配使用, 以及與任何 IoT 隨插即用裝置搭配使用的模型驅動解決方案。

此概念文章說明如何在兩種類型的方案中執行模型探索。

## <a name="model-discovery"></a>模型探索

當 IoT 隨插即用裝置第一次連接到您的 IoT 中樞時, 它會傳送模型資訊遙測訊息。 此訊息包含裝置所執行介面的識別碼。 為了讓您的解決方案與裝置搭配使用, 它必須解析這些識別碼, 並抓取每個介面的定義。

以下是 IoT 隨插即用裝置在使用裝置布建服務 (DPS) 連線至中樞時所採取的步驟:

1. 當裝置開啟時, 它會連線到 DPS 的全域端點, 並使用其中一種允許的方法進行驗證。
1. 接著, DPS 會驗證裝置並尋找規則, 告訴它要將裝置指派給哪個 IoT 中樞。 然後, DPS 會向該中樞註冊裝置。
1. DPS 會將 IoT 中樞連接字串傳回至裝置。
1. 裝置接著會將探索遙測訊息傳送至您的 IoT 中樞。 探索遙測訊息包含裝置所實行介面的識別碼。
1. IoT 隨插即用裝置現在已準備好搭配使用 IoT 中樞的解決方案。

如果裝置直接連接到您的 IoT 中樞, 則會使用內嵌在裝置程式碼中的連接字串進行連線。 裝置接著會將探索遙測訊息傳送至您的 IoT 中樞。

若要深入瞭解模型資訊遙測訊息, 請參閱[ModelInformation](concepts-common-interfaces.md)介面。

### <a name="purpose-built-iot-solutions"></a>專門打造的 IoT 解決方案

專門建立的 IoT 解決方案適用于一組已知的 IoT 隨插即用裝置功能模型和介面。

您將會有裝置的功能模型和介面, 以便在一段時間內連接到您的解決方案。 使用下列步驟來準備您的解決方案:

1. 將介面 JSON 檔案儲存在 Azure 中, 您的解決方案可以在此位置讀取這些檔案。
1. 根據預期的 IoT 隨插即用功能模型和介面, 在 IoT 解決方案中撰寫邏輯。
1. 訂閱您的解決方案所使用之 IoT 中樞的通知。

當您收到新裝置連線的通知時, 請遵循下列步驟:

1. 請閱讀探索遙測訊息, 以抓取裝置所執行的功能模型和介面的識別碼。
1. 比較功能模型的識別碼與您之前儲存的功能模型識別碼。
1. 現在您知道裝置的類型已連線。 使用您稍早撰寫的邏輯, 讓使用者能夠適當地與裝置互動。

### <a name="model-driven-solutions"></a>模型驅動解決方案

模型驅動的 IoT 解決方案可與任何 IoT 隨插即用裝置搭配使用。 建立模型驅動的 IoT 解決方案更複雜, 但好處是您的解決方案會與未來新增的任何裝置搭配運作。

若要建立模型驅動的 IoT 解決方案, 您必須針對 IoT 隨插即用介面基本類型建立邏輯: 遙測、屬性和命令。 您的 IoT 解決方案邏輯會藉由結合多個遙測、屬性和命令功能來代表裝置。

您的解決方案也必須訂閱其所使用之 IoT 中樞的通知。

當您的解決方案收到新裝置連線的通知時, 請遵循下列步驟:

1. 請閱讀探索遙測訊息, 以抓取裝置所執行的功能模型和介面的識別碼。
1. 針對每個識別碼, 請閱讀完整的 JSON 檔案以尋找裝置的功能。
1. 檢查您所建立的任何快取中是否有每個介面, 以儲存您的解決方案稍早所抓取的 JSON 檔案。
1. 然後, 檢查具有該識別碼的介面是否存在於全域模型存放庫中。 如需詳細資訊, 請參閱[全域模型存放庫](howto-manage-models.md)。
1. 如果介面不存在於全域模型存放庫中, 請嘗試在您的解決方案已知的任何私用模型存放庫中尋找它。 您需要連接字串才能存取私用模型存放庫。 如需詳細資訊, 請參閱[私用模型存放庫](howto-manage-models.md)。
1. 如果您找不到全域模型存放庫或私用模型存放庫中的所有介面, 可以檢查裝置是否可以提供介面定義。 裝置可以執行標準的[ModelDefinition](concepts-common-interfaces.md)介面, 以發佈有關如何使用命令來取得介面檔案的資訊。
1. 如果您找到裝置所執行之每個介面的 JSON 檔案, 您可以列舉裝置的功能。 使用您稍早撰寫的邏輯, 讓使用者能夠與裝置互動。
1. 您隨時都可以呼叫數位 twins API 來取得裝置的功能模型識別碼和介面識別碼。

## <a name="next-steps"></a>後續步驟

既然您已瞭解如何使用 IoT 解決方案來探索模型, 請深入瞭解[Azure Iot 平臺](overview-iot-plug-and-play.md), 以利用您解決方案的其他功能。
