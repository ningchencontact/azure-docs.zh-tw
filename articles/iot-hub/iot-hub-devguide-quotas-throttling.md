---
title: 了解 Azure IoT 中樞配額和節流 | Microsoft Docs
description: 開發人員指南 - 說明適用於 IoT 中樞的配額和預期的節流行為。
author: robinsh
ms.author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.openlocfilehash: 0e60607d50722a4496dc8f4ad7d609cdf9fd5792
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2019
ms.locfileid: "69877177"
---
# <a name="reference---iot-hub-quotas-and-throttling"></a>參考 - IoT 中樞配額和節流

本文說明 IoT 中樞的配額, 並提供資訊來協助您瞭解節流的運作方式。

## <a name="quotas-and-throttling"></a>配額和節流

每個 Azure 訂用帳戶最多可以有 50 個 IoT 中樞，以及最多 1 個可用中樞。

佈建每個 IoT 中樞時，都會為其佈建特定層級中的特定單位數。 層級和單位數會決定您每天可傳送的訊息配額上限。 對於免費層中樞，用來計算每日配額的訊息大小為 0.5 KB，而對於所有其他層的訊息大小則為 4 KB。 如需詳細資訊，請參閱 [Azure IoT 中樞價格](https://azure.microsoft.com/pricing/details/iot-hub/)。

層級也會決定「IoT 中樞」在所有作業上強制執行的節流限制。

### <a name="iot-plug-and-play"></a>IoT Plug and Play

在公開預覽期間, IoT 隨插即用裝置會針對每個介面傳送個別的訊息, 這可能會增加計入訊息配額的訊息數目。

## <a name="operation-throttles"></a>作業節流

作業節流是在分鐘範圍內套用的速率限制, 目的在於防止濫用。 它們也受限於[流量成形](#traffic-shaping)。

下表顯示強制執行的節流。 個別中心的值如下。

| 節流 | 免費、B1 及 S1 | B2 和 S2 | B3 和 S3 | 
| -------- | ------- | ------- | ------- |
| 身分[識別登錄作業](#identity-registry-operations-throttle)(建立、取得、列出、更新、刪除) | 1.67/秒/單位 (100/分鐘/單位) | 1.67/秒/單位 (100/分鐘/單位) | 83.33/秒/單位 (5000/分鐘/單位) |
| [新的裝置](#device-connections-throttle)連線(此限制適用于_新連接_的速率, 而不是連線總數) | 100/秒或 12/秒/單位較高者 <br/> 例如，兩個 S1 單位是 2\*12 = 24 個新連線/秒，但是您在所有單位上至少擁有 100 個新連線/秒。 如果有九個 S1 單位，您的全部單位就會擁有 108 個新連線/秒 (9\*12)。 | 120 個新連線/秒/單位 | 6000新連線數/秒/單位 |
| 裝置到雲端傳送 | 較高的100傳送作業/秒或12個傳送作業/秒/單位 <br/> 例如, 兩個 S1 單位是 2\*12 = 24/秒, 但是您在整個單位中至少有100個傳送作業/秒。 有九個 S1 單位, 您的單位會有108個傳送\*作業/秒 (9 12)。 | 120傳送作業/秒/單位 | 6000傳送作業/秒/單位 |
| 雲端到裝置的傳送<sup>1</sup> | 1.67 傳送作業/秒/單位 (100 個訊息/分鐘/單位) | 1.67 傳送作業/秒/單位 (100 傳送作業/分鐘/單位) | 83.33 傳送作業/秒/單位 (5000 傳送作業/分鐘/單位) |
| 雲端到裝置的接收<sup>1</sup> <br/> (僅限裝置使用 HTTPS 時)| 16.67 接收作業/秒/單位 (1000 接收作業/分鐘/單位) | 16.67 接收作業/秒/單位 (1000 接收作業/分鐘/單位) | 833.33 接收作業/秒/單位 (50000 接收作業/分鐘/單位) |
| 檔案上傳 | 1.67 檔案上傳通知/秒/單位 (100/分鐘/單位) | 1.67 檔案上傳通知/秒/單位 (100/分鐘/單位) | 83.33 檔案上傳通知/秒/單位 (5000/分鐘/單位) |
| 直接方法<sup>1</sup> | 160 KB/秒/單位<sup>2</sup> | 480 KB/秒/單位<sup>2</sup> | 24 MB/秒/單位<sup>2</sup> | 
| 查詢 | 20/分鐘/單位 | 20/分鐘/單位 | 1000/分鐘/單位 |
| 對應項 (裝置與模組) 讀取<sup>1</sup> | 100/秒 | 高於 100/秒或 10/秒/單位 | 500/秒/單位 |
| 對應項更新 (裝置與模組)<sup>1</sup> | 50/秒 | 上限為 50/秒或 5/秒/單位 | 250/秒/單位 |
| 作業操作<sup>1</sup> <br/> (建立、更新、列出、刪除) | 1.67/秒/單位 (100/分鐘/單位) | 1.67/秒/單位 (100/分鐘/單位) | 83.33/秒/單位 (5000/分鐘/單位) |
| 作業裝置操作<sup>1</sup> <br/> (更新對應項，叫用直接方法) | 10/秒 | 10/秒或 1/秒/單位較高者 | 50/秒/單位 |
| 設定與 Edge 部署<sup>1</sup> <br/> (建立、更新、列出、刪除) | 0.33/秒/單位 (20/分鐘/單位) | 0.33/秒/單位 (20/分鐘/單位) | 0.33/秒/單位 (20/分鐘/單位) |
| 裝置串流初始速率<sup>1</sup> | 5 個新串流/秒 | 5 個新串流/秒 | 5 個新串流/秒 |
| 同時連線的裝置串流數上限<sup>1</sup> | 50 | 50 | 50 |
| 裝置串流資料傳輸上限<sup>1</sup> (每天匯總磁片區) | 300 MB | 300 MB | 300 MB |

<sup>1</sup>「IoT 中樞」的基本層中不提供此功能。 如需詳細資訊，請參閱[如何選擇適合的 IoT 中樞](iot-hub-scaling.md)。 <br/><sup>2</sup>節流計量大小為 4 KB。

### <a name="throttling-details"></a>節流詳細資料

* 計量大小會決定耗用節流限制的遞增量。 如果您的直接呼叫承載介於0到 4 KB 之間, 則會計算為 4 KB。 在達到 160 KB/秒/單位的限制之前, 您可以為每個單位每秒最多建立40個呼叫。

   同樣地, 如果您的承載介於 4 KB 和 8 KB 之間, 則每個呼叫都有 8 KB, 而您在達到最大限制之前, 每個單位的每秒最多可以建立20個呼叫。

   最後, 如果您的承載大小介於156KB 和 160 KB 之間, 則在達到 160 KB/秒/單位的限制之前, 您將能夠只對中樞的每個單位進行1個呼叫。

*  針對第 S2 層的*作業 (更新對應項, 叫用直接方法)* , 只有當您使用作業叫用方法時, 才會套用 50/秒/單位。 如果您直接叫用直接方法, 則會套用 24 MB/秒/單位 (適用于 S2) 的原始節流限制。

*  **配額**是您*每天*可以在中樞傳送的訊息匯總數目。 您可以在[IoT 中樞定價頁面](https://azure.microsoft.com/pricing/details/iot-hub/)上的 [**訊息總數**] 欄底下找到中樞的配額限制。

*  您的雲端到裝置和裝置到雲端的節流會決定您可以傳送訊息的最大*速率*--無論 4 KB 區塊的訊息數目。 每則訊息的最大值為 256 KB, 也就是[訊息大小上限](iot-hub-devguide-quotas-throttling.md#other-limits)。

*  最好的作法是節流呼叫, 讓您不會達到/超過節流限制。 如果您達到此限制, IoT 中樞會以錯誤碼429回應, 而用戶端應該會改為關閉並重試。 這些限制是每個中樞 (或在某些情況下, 每個中樞/單位)。 如需詳細資訊, 請參閱[管理連線能力和可靠的訊息/重試模式](iot-hub-reliability-features-in-sdks.md#retry-patterns)。

### <a name="traffic-shaping"></a>流量成形

為了容納高載流量, IoT 中樞會在有限的時間中接受節流的要求。 這些要求的前幾個會立即處理。 不過, 如果要求的數目持續違反節流, IoT 中樞會開始將要求放在佇列中, 並以限制的速率處理。 這種效果稱為「*流量成形*」。 此外, 此佇列的大小也會受到限制。 如果節流違規繼續, 最後佇列會填滿, IoT 中樞開始拒絕使用的`429 ThrottlingException`要求。

例如, 您可以使用模擬裝置, 每秒將200的裝置到雲端訊息傳送到您的 S1 IoT 中樞 (其限制為每秒 D2C 個)。 在第一分鐘或兩個中, 訊息會立即處理。 不過, 由於裝置會繼續傳送比節流限制更多的訊息, IoT 中樞一開始只會處理每秒100個訊息, 並將其餘部分放在佇列中。 您開始注意到增加的延遲。 最後, 您會開始`429 ThrottlingException`在佇列填滿, 而[IoT 中樞的計量](iot-hub-metrics.md)中的「節流錯誤數目」開始增加。

### <a name="identity-registry-operations-throttle"></a>身分識別登錄作業節流

裝置身分識別登錄作業適用于在裝置管理和布建案例中使用的執行時間。 透過[匯入和匯出作業](iot-hub-devguide-identity-registry.md#import-and-export-device-identities)，即可支援讀取或更新大量的裝置身分識別。

### <a name="device-connections-throttle"></a>裝置連接節流

「裝置連線」節流會控制新裝置可與 IoT 中樞建立連線的速率。 「裝置連線」節流不會控制同時連線裝置的數目上限。 「裝置連線」速率節流受制於為 IoT 中樞佈建的單位數。

例如，若您購買單一 S1 單位，則得到每秒 100 個連線的節流。 因此, 若要連接100000裝置, 至少需要1000秒 (約16分鐘)。 不過，若您已將裝置登錄在您的身分識別登錄中，則可以有任意數量的同時連線裝置。

## <a name="other-limits"></a>其他限制

IoT 中樞會強制執行其他操作限制：

| 運算 | 限制 |
| --------- | ----- |
| 裝置 | 您可以連接到單一 IoT 中樞的裝置數目上限為1000000。 增加此限制的唯一方式是聯絡[Microsoft 支援服務](https://azure.microsoft.com/support/options/)。|
| 檔案上傳 | 每個裝置10個並行檔案上傳。 |
| 作業<sup>1</sup> | 並行作業的最大值為 1 (免費和 S1)、5 (適用于 S2) 和 10 (適用于 S3)。 不過, 所有層的並行[裝置匯入/匯出作業](iot-hub-bulk-identity-mgmt.md)數上限為1。 <br/>作業歷程記錄會保留最多30天。 |
| 額外端點 | 付費 SKU 中樞包含 10 個額外端點。 免費 SKU 中樞包含 1 個額外端點。 |
| 訊息路由查詢 | 付費 SKU 中樞可能會有100的路由查詢。 免費的 SKU 中樞可能有五個路由查詢。 |
| 訊息擴充 | 付費 SKU 中樞最多可以有10個訊息擴充。 免費的 SKU 中樞最多可以有2個訊息擴充。|
| 裝置到雲端傳訊 | 訊息大小上限為 256 KB |
| 雲端到裝置的傳訊<sup>1</sup> | 訊息大小上限為 64 KB。 每個裝置的傳遞擱置訊息上限為50。 |
| 直接方法<sup>1</sup> | 直接方法承載的大小上限為 128 KB。 |
| 自動裝置組態 <sup>1</sup> | 每個付費 SKU 中樞 100 項設定。 每個免費 SKU 中樞 20 項設定。 |
| IoT Edge 自動部署<sup>1</sup> | 每個部署 20 個模組。 每個付費中樞 100 個部署。 每個免費 SKU 中樞10個部署。 |
| 對應項<sup>1</sup> | 每個對應項區段 (標籤、所需屬性、報告屬性) 的大小上限為 8 KB |

<sup>1</sup>「IoT 中樞」的基本層中不提供此功能。 如需詳細資訊，請參閱[如何選擇適合的 IoT 中樞](iot-hub-scaling.md)。

## <a name="increasing-the-quota-or-throttle-limit"></a>增加配額或節流限制

在任何指定的時間, 您都可以藉由[增加 IoT 中樞內布建的單位數](iot-hub-upgrade.md)來增加配額或節流限制。

## <a name="latency"></a>延遲

IoT 中樞會努力地為所有作業提供低延遲的服務。 不過, 由於網路狀況和其他無法預測的因素, 它無法保證特定的延遲。 設計您的解決方案時，您應該：

* 避免進行有關任何 IoT 中樞作業最大延遲的任何假設。
* 在與您的裝置最靠近的 Azure 區域中佈建 IoT 中樞。
* 考慮使用 Azure IoT Edge 在裝置或靠近裝置的閘道上執行無法容忍延遲的作業。

如先前所述，多個 IoT 中樞單位既會影響節流功能，又不會提供額外的延遲好處或保證。

如果您注意到作業的延遲時間莫名其妙增加，請連絡 [Microsoft 支援服務](https://azure.microsoft.com/support/options/)。

## <a name="next-steps"></a>後續步驟

如需有關 IoT 中樞節流行為的深入討論，請參閱 [IoT Hub throttling and you (IoT 中樞節流和您)](https://azure.microsoft.com/blog/iot-hub-throttling-and-you/) 部落格文章。

此 IoT 中樞開發人員指南中的其他參考主題包括︰

* [IoT 中樞端點](iot-hub-devguide-endpoints.md)
